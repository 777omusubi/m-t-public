<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex,nofollow">

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K4STVPWK6G"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-K4STVPWK6G');
</script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥‡ğŸ’° METALS TREEMAP v3.29 ğŸ’°ğŸ’</title>
    <style>
        /* Google Fontsã®èª­ã¿è¾¼ã¿ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ« - ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆã‚’ä½¿ç”¨ï¼‰ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { overflow-x: hidden; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
            font-size: 14px;
            position: relative;
        }
        
        .container {
            width: 100vw;
            min-height: 100vh;
            padding: 25px 15px 15px 15px;
            position: relative;
            z-index: 1;
            background: inherit;
            max-width: none;
            overflow-x: auto;
        }
        
        .header { text-align: center; margin-bottom: 20px; padding-top: 10px; }
        
        .title {
            font-size: clamp(1.3rem, 3.5vw, 2.2rem);
            font-weight: 900;
            margin-bottom: 5px;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF6B35, #F7931E);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes titleGlow {
            0% { filter: brightness(1) drop-shadow(0 0 20px rgba(255, 215, 0, 0.3)); }
            100% { filter: brightness(1.3) drop-shadow(0 0 40px rgba(255, 215, 0, 0.6)); }
        }
        
        .subtitle {
            font-size: clamp(0.8rem, 1.8vw, 1rem);
            opacity: 0.9;
            margin-bottom: 10px;
            color: #FFD700;
            font-weight: 600;
        }
        
        .disclaimer {
            font-size: clamp(0.9rem, 1.6vw, 1.1rem);
            opacity: 0.85;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            text-align: center;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .disclaimer p {
            margin-bottom: 8px;
        }
        
        .disclaimer .signature {
            display: inline;
            font-size: clamp(0.9rem, 1.6vw, 1.1rem);
            opacity: 0.85;
            color: rgba(255, 255, 255, 0.8);
            font-style: normal;
            margin-left: 1em;
        }
        
        .server-setup {
            background: rgba(255, 255, 255, 0.08);
            padding: 12px;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
        }
        
        .api-input-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .test-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border: none;
            color: #000;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            font-size: clamp(0.7rem, 1.2vw, 0.85rem);
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }
        
        .server-status {
            margin-top: 8px;
            font-size: clamp(0.6rem, 1vw, 0.75rem);
            text-align: center;
            line-height: 1.3;
            min-height: 40px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            margin: 15px 0;
        }
        
        .period-buttons {
            display: flex;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 6px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .period-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            color: white;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: clamp(0.6rem, 1vw, 0.75rem);
            min-width: 80px;
        }
        
        .period-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .period-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .update-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            color: #000;
            font-weight: 700;
            font-size: clamp(0.7rem, 1.2vw, 0.85rem);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }
        
        .update-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }
        
        .update-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .update-btn.loading .update-icon {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .last-update {
            font-size: clamp(0.6rem, 1vw, 0.7rem);
            opacity: 0.7;
            margin-top: 5px;
        }
        
        /* å¸‚å ´é–‹å ´æ™‚é–“è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« */
        .market-hours {
            margin-top: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .market-hours-title {
            font-size: clamp(0.7rem, 1.2vw, 0.9rem);
            font-weight: 700;
            color: #FFD700;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .market-hours-info {
            font-size: clamp(0.6rem, 1vw, 0.7rem);
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            margin-bottom: 10px;
            padding: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }
        
        .market-hours-chart {
            display: flex;
            flex-direction: column;
            gap: 4px;
            overflow-x: auto;
            min-width: 100%;
        }
        
        .market-hours-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            min-width: 620px; /* æœ€å°å¹…ã‚’600pxã‹ã‚‰620pxã«æ‹¡å¼µ */
        }
        
        .market-hours-header .market-name {
            width: 100px;
            min-width: 100px; /* å›ºå®šå¹…ã‚’80pxã‹ã‚‰100pxã«æ‹¡å¼µ */
            font-size: clamp(0.6rem, 1vw, 0.7rem);
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            flex-shrink: 0;
        }
        
        .hours-grid {
            display: flex;
            gap: 0;
            flex: 1;
            min-width: 520px; /* 24æ™‚é–“ Ã— ç´„21.7px */
        }
        
        .hours-grid span {
            flex: 1;
            text-align: center;
            font-size: clamp(0.5rem, 0.8vw, 0.6rem);
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            min-width: 21.7px; /* 520px Ã· 24æ™‚é–“ */
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .hours-grid span:last-child {
            border-right: none;
        }
        
        .market-row {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 620px; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã¨åŒã˜æœ€å°å¹… */
        }
        
        .market-info {
            display: flex;
            align-items: center;
            gap: 4px;
            width: 100px;
            min-width: 100px; /* å›ºå®šå¹…ã‚’80pxã‹ã‚‰100pxã«æ‹¡å¼µ */
            flex-shrink: 0;
        }
        
        .market-info .flag {
            font-size: clamp(0.8rem, 1.2vw, 1rem);
        }
        
        .market-info .market-name {
            font-size: clamp(0.6rem, 1vw, 0.7rem);
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }
        
        .hours-bar {
            height: 16px;
            border-radius: 8px;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            position: relative;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            min-width: 520px; /* æ™‚é–“ã‚°ãƒªãƒƒãƒ‰ã¨åŒã˜å¹… */
        }
        
        /* å„å¸‚å ´ã®é–‹å ´æ™‚é–“ï¼ˆJavaScriptã§å‹•çš„ã«è¨­å®šï¼‰ */
        .us-hours, .ca-hours, .gb-hours, .au-hours, .jp-hours {
            background: linear-gradient(90deg, 
                transparent 0%, 
                transparent 0%, 
                #4CAF50 0%, 
                #4CAF50 0%, 
                transparent 0%, 
                transparent 100%);
        }
        
        .data-warning {
            background: rgba(255, 152, 0, 0.15);
            border: 1px solid rgba(255, 152, 0, 0.4);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: clamp(0.65rem, 1vw, 0.75rem);
            margin-top: 8px;
            text-align: center;
        }
        
        .metals-treemap {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1900px;
            margin: 0 auto;
            padding: 20px 8px 120px 8px;
            min-height: calc(100vh - 200px);
        }
        
        .metal-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            position: relative;
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }
        
        .metal-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--metal-color);
            border-radius: 15px 15px 0 0;
        }
        
        .metal-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .metal-icon { font-size: clamp(1.5rem, 2.5vw, 2rem); }
        
        .metal-title {
            font-weight: 800;
            color: var(--metal-color);
            flex: 1;
            font-size: clamp(1rem, 1.8vw, 1.4rem);
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
        }
        
        .metal-subtitle {
            opacity: 0.8;
            font-size: clamp(0.7rem, 1.2vw, 0.9rem);
            font-weight: 600;
        }
        
        .gold-section { --metal-color: #FFD700; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05)); }
        .silver-section { --metal-color: #C0C0C0; background: linear-gradient(135deg, rgba(192, 192, 192, 0.1), rgba(192, 192, 192, 0.05)); }
        .copper-section { --metal-color: #FF6B35; background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(255, 107, 53, 0.05)); }
        .fertilizer-section { --metal-color: #7CFC00; background: linear-gradient(135deg, rgba(124, 252, 0, 0.1), rgba(124, 252, 0, 0.05)); }
        .platinum-section { --metal-color: #E6E6FA; background: linear-gradient(135deg, rgba(230, 230, 250, 0.1), rgba(230, 230, 250, 0.05)); }
        .lithium-section { --metal-color: #00D4FF; background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(0, 212, 255, 0.05)); }
        .uranium-section { --metal-color: #39FF14; background: linear-gradient(135deg, rgba(57, 255, 20, 0.1), rgba(57, 255, 20, 0.05)); }
        .nickel-section { --metal-color: #B0E0E6; background: linear-gradient(135deg, rgba(176, 224, 230, 0.1), rgba(176, 224, 230, 0.05)); }
        .ree-section { --metal-color: #FF1493; background: linear-gradient(135deg, rgba(255, 20, 147, 0.1), rgba(255, 20, 147, 0.05)); }
        .titanium-section { --metal-color: #A0A0A0; background: linear-gradient(135deg, rgba(160, 160, 160, 0.1), rgba(160, 160, 160, 0.05)); }
        
        .tiles-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            flex: 1;
            align-items: flex-start;
            justify-content: flex-start;
            min-height: 200px;
        }
        
        .dynamic-tile {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            min-width: 120px;
            min-height: 100px;
            padding: 8px;
            overflow: hidden;
        }
        
        .chart-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.35;
            z-index: 1;
            pointer-events: none;
        }
        
        .dynamic-tile:hover {
            transform: translateY(-6px) scale(1.05);
            z-index: 10;
            border-color: var(--metal-color);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
        }
        
        .size-mega { width: 380px; height: 240px; border-width: 5px; }
        .size-ultra-large { width: 320px; height: 200px; border-width: 4px; }
        .size-extra-large { width: 280px; height: 180px; border-width: 3px; }
        .size-large { width: 240px; height: 160px; border-width: 3px; }
        .size-medium { width: 200px; height: 140px; border-width: 2px; }
        .size-small { width: 170px; height: 120px; border-width: 2px; }
        .size-mini { width: 140px; height: 110px; border-width: 2px; }
        .size-micro { width: 120px; height: 95px; border-width: 1px; }
        
        .tile-content {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            height: 100%;
            width: 100%;
            gap: 4px;
            position: relative;
            padding: 4px 8px;
            z-index: 2;
        }
        
        .size-small .tile-content,
        .size-mini .tile-content,
        .size-micro .tile-content {
            gap: 1px;
            padding: 3px 6px;
        }
        
        .sort-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: clamp(0.65rem, 1vw, 0.75rem);
            font-weight: 600;
            transition: all 0.3s ease;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .sort-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
        }
        
        .sort-btn.active {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            border-color: #FFD700;
        }
        
        .sort-btn .sort-icon {
            font-size: 0.9em;
        }
        
        .sector-label {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            font-weight: 800;
            font-size: clamp(0.55rem, 0.75vw, 0.7rem);
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid var(--metal-color);
            min-width: 35px;
            text-align: center;
            z-index: 5;
        }
        
        /* æ®µå·®ï¼ˆZãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰æ–¹å¼ï¼šå¥å…¨æ€§ã®è¦–è¦šè¡¨ç¾ã¯å‰Šé™¤æ¸ˆã¿ */
        /* wobble_levelã®è¨ˆç®—ã¯ç¶™ç¶šã™ã‚‹ãŒã€è¦–è¦šçš„ãªå·®ã¯è¡¨ç¤ºã—ãªã„ */
        
        .metal-tag {
            position: absolute;
            bottom: 4px;
            right: 4px;
            font-weight: 700;
            font-size: clamp(0.6rem, 0.9vw, 0.8rem);
            padding: 3px 6px;
            border-radius: 4px;
            opacity: 0.95;
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #FFD700;
            text-align: center;
            z-index: 5;
            max-width: 70%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 0 0 8px rgba(0, 0, 0, 1);
        }
        
        .size-mega .ticker, .size-ultra-large .ticker, .size-extra-large .ticker {
            font-size: clamp(1.5rem, 3.5vw, 3.8rem);
            font-weight: 900;
            color: #ffffff;
            margin-bottom: 6px;
            margin-left: -0.25em;
            line-height: 1;
            text-shadow: 0 0 30px rgba(0, 0, 0, 1), 0 0 20px rgba(0, 0, 0, 1), 4px 4px 12px rgba(0, 0, 0, 1);
            align-self: flex-start;
            width: calc(100% - 70px);
            text-align: left;
            padding-left: 30px; /* IBãƒ©ãƒ™ãƒ«ã¨ã‚°ãƒ¬ãƒ¼ãƒ‰è¡¨ç¤ºã¨ã®é‡è¤‡ã‚’é¿ã‘ã‚‹ */
        }
        
        .size-large .ticker, .size-medium .ticker {
            font-size: clamp(1.2rem, 2.8vw, 3rem);
            font-weight: 900;
            color: #ffffff;
            margin-bottom: 6px;
            margin-left: -0.25em;
            line-height: 1;
            text-shadow: 0 0 30px rgba(0, 0, 0, 1), 0 0 20px rgba(0, 0, 0, 1), 4px 4px 12px rgba(0, 0, 0, 1);
            align-self: flex-start;
            width: calc(100% - 60px);
            text-align: left;
            padding-left: 25px; /* IBãƒ©ãƒ™ãƒ«ã¨ã‚°ãƒ¬ãƒ¼ãƒ‰è¡¨ç¤ºã¨ã®é‡è¤‡ã‚’é¿ã‘ã‚‹ */
        }
        
        .size-small .ticker, .size-mini .ticker, .size-micro .ticker {
            font-size: clamp(1rem, 2.2vw, 2.2rem);
            font-weight: 900;
            color: #ffffff;
            margin-bottom: 4px;
            margin-left: -0.25em;
            line-height: 1;
            text-shadow: 
                0 0 40px rgba(0, 0, 0, 1),
                0 0 30px rgba(0, 0, 0, 1),
                0 0 20px rgba(0, 0, 0, 1),
                5px 5px 15px rgba(0, 0, 0, 1),
                -2px -2px 10px rgba(0, 0, 0, 1);
            align-self: flex-start;
            width: calc(100% - 50px);
            text-align: left;
            position: relative;
            z-index: 10;
            padding-left: 20px; /* IBãƒ©ãƒ™ãƒ«ã¨ã‚°ãƒ¬ãƒ¼ãƒ‰è¡¨ç¤ºã¨ã®é‡è¤‡ã‚’é¿ã‘ã‚‹ */
        }
        
        /* RSIè¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« */
        .rsi-quadrant {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            z-index: 15;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
            background: transparent; /* èƒŒæ™¯ã‚’é€æ˜ã«ã—ã¦å‘¨å›²ã®è‰²ã¨åŒã˜ã«ã™ã‚‹ */
        }
        
        /* å›½åãƒ©ãƒ™ãƒ«ãŒã‚ã‚‹å ´åˆã®RSIä½ç½®èª¿æ•´ */
        .dynamic-tile:has(.country-label) .rsi-quadrant {
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
        }
        
        .rsi-label {
            font-size: clamp(0.9rem, 1.4vw, 1.4rem);
            font-weight: 600;
            color: #ffffff; /* ç™½è‰² */
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
            line-height: 1;
        }
        
        .rsi-value {
            font-size: clamp(1.1rem, 1.8vw, 1.8rem);
            font-weight: 800;
            text-shadow: 0 0 15px rgba(0, 0, 0, 0.9);
            line-height: 1;
        }
        
        /* RSIå€¤ã®è‰²åˆ†ã‘è¡¨ç¤º */
        .rsi-value.oversold {
            color: #FFFF00; /* æ˜ã‚‹ã„é»„è‰² - RSI 30ä»¥ä¸‹ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸/èµ¤èƒŒæ™¯ã§ã‚‚è¦‹ã‚„ã™ã„ï¼‰ */
        }
        
        .rsi-value.neutral {
            color: #ffffff; /* ç™½è‰² - RSI 31-69 */
        }
        
        .rsi-value.overbought {
            color: #9333EA; /* ç´«è‰² - RSI 70ä»¥ä¸Š */
        }
        
        .size-small .change, .size-mini .change, .size-micro .change {
            font-size: clamp(1rem, 2vw, 2.2rem);
            font-weight: 900;
            line-height: 1.1;
            color: #ffffff;
            margin-left: -0.5em;
            text-shadow: 
                0 0 50px rgba(0, 0, 0, 1),
                0 0 40px rgba(0, 0, 0, 1),
                0 0 30px rgba(0, 0, 0, 1),
                0 0 20px rgba(0, 0, 0, 1),
                6px 6px 18px rgba(0, 0, 0, 1),
                -3px -3px 12px rgba(0, 0, 0, 1) !important;
            filter: contrast(1.5) brightness(1.4);
            width: calc(100% - 50px);
            text-align: left;
            align-self: flex-start;
            margin-bottom: 6px;
            position: relative;
            z-index: 10;
        }
        
        .size-small .price, .size-mini .price, .size-micro .price {
            font-size: clamp(0.7rem, 1.5vw, 1.6rem);
            opacity: 0.9;
            color: #ffffff;
            margin-bottom: 2px;
            margin-left: 1.2em;
            font-weight: 700;
            text-shadow: 0 0 30px rgba(0, 0, 0, 1), 0 0 20px rgba(0, 0, 0, 1), 3px 3px 10px rgba(0, 0, 0, 1);
            width: calc(100% - 60px);
            text-align: left;
            align-self: flex-start;
            position: relative;
            z-index: 10;
        }
        
        .change {
            font-size: clamp(1.1rem, 2.2vw, 2.6rem);
            font-weight: 900;
            line-height: 1.1;
            color: #ffffff;
            margin-left: -0.5em;
            text-shadow: 
                0 0 40px rgba(0, 0, 0, 1),
                0 0 30px rgba(0, 0, 0, 1),
                0 0 20px rgba(0, 0, 0, 1),
                0 0 10px rgba(0, 0, 0, 1),
                5px 5px 15px rgba(0, 0, 0, 1),
                -2px -2px 10px rgba(0, 0, 0, 0.8) !important;
            filter: contrast(1.4) brightness(1.3);
            width: calc(100% - 60px);
            text-align: left;
            align-self: flex-start;
            margin-bottom: 8px;
            position: relative;
            z-index: 10;
        }
        
        .market-cap {
            font-size: clamp(0.8rem, 1.3vw, 1.4rem);
            opacity: 0.85;
            color: #ffffff;
            font-weight: 700;
            margin-top: 3px;
            margin-left: -0.5em;
            text-shadow: 0 0 30px rgba(0, 0, 0, 1), 0 0 20px rgba(0, 0, 0, 1), 3px 3px 10px rgba(0, 0, 0, 1);
            width: calc(100% - 60px);
            text-align: left;
            align-self: flex-start;
        }
        
        .price {
            font-size: clamp(0.9rem, 1.6vw, 1.8rem);
            opacity: 0.9;
            color: #ffffff;
            margin-bottom: 2px;
            margin-left: 1.2em;
            font-weight: 700;
            text-shadow: 0 0 30px rgba(0, 0, 0, 1), 0 0 20px rgba(0, 0, 0, 1), 3px 3px 10px rgba(0, 0, 0, 1);
            width: calc(100% - 60px);
            text-align: left;
            align-self: flex-start;
        }
        
        .gain-extreme { background: linear-gradient(135deg, #00FF00 0%, #32FF32 100%); border-color: #00FF00; }
        .gain-high { background: linear-gradient(135deg, #00C851 0%, #00FF00 100%); border-color: #00C851; }
        
        .country-label {
            position: absolute;
            top: 2px;
            left: 2px;
            background: #0066CC;
            color: white;
            font-size: clamp(0.6rem, 1vw, 0.8rem);
            font-weight: 800;
            padding: 2px 4px;
            border-radius: 3px;
            z-index: 30;
            text-shadow: none;
            box-shadow: 0 1px 3px rgba(0, 102, 204, 0.4);
            min-width: 24px;
            text-align: center;
            border: 1px solid #004499;
        }
        
        .country-label::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            height: 1px;
            background: #0066CC;
            z-index: -1;
        }
        
        /* è©•ä¾¡ã‚°ãƒ¬ãƒ¼ãƒ‰è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« */
        .grade-label {
            position: absolute;
            top: 28px;
            left: 2px;
            background: #00FFFF;
            border: 2px solid #00FFFF;
            border-radius: 4px;
            padding: 2px 4px;
            font-weight: 900;
            font-size: clamp(0.6rem, 0.9vw, 0.8rem);
            z-index: 15;
            min-width: 20px;
            text-align: center;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.6);
        }
        
        /* ã‚°ãƒ¬ãƒ¼ãƒ‰åˆ¥ãƒ•ã‚©ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ï¼ˆç·‘è‰²èƒŒæ™¯ã§ã‚‚è¦‹ã‚„ã™ã„è‰²ï¼‰ */
        .grade-label.grade-a {
            color: #FFFFFF; /* ç™½è‰² - Aï¼ˆæœ€ã‚‚ç›®ç«‹ã¤ï¼‰ */
            background: #FF0000; /* èµ¤è‰²èƒŒæ™¯ */
            border-color: #FF0000;
        }
        
        .grade-label.grade-a-minus {
            color: #FFFFFF; /* ç™½è‰² - A- */
            background: #FF4500; /* ã‚ªãƒ¬ãƒ³ã‚¸ãƒ¬ãƒƒãƒ‰èƒŒæ™¯ */
            border-color: #FF4500;
        }
        
        .grade-label.grade-b-plus {
            color: #FFFFFF; /* ç™½è‰² - B+ */
            background: #FF8C00; /* ãƒ€ãƒ¼ã‚¯ã‚ªãƒ¬ãƒ³ã‚¸èƒŒæ™¯ */
            border-color: #FF8C00;
        }
        
        .grade-label.grade-b {
            color: #FFFFFF; /* ç™½è‰² - B */
            background: #FFD700; /* é‡‘è‰²èƒŒæ™¯ */
            border-color: #FFD700;
        }
        
        .grade-label.grade-b-minus {
            color: #000000; /* é»’è‰² - B- */
            background: #FFFF00; /* é»„è‰²èƒŒæ™¯ */
            border-color: #FFFF00;
        }
        .gain-medium { background: linear-gradient(135deg, #4CAF50 0%, #7CB342 100%); border-color: #4CAF50; }
        .gain-low { background: linear-gradient(135deg, #8BC34A 0%, #9CCC65 100%); border-color: #8BC34A; }
        .loss-low { background: linear-gradient(135deg, #FF9800 0%, #FFC107 100%); border-color: #FF9800; }
        .loss-medium { background: linear-gradient(135deg, #FF5722 0%, #F44336 100%); border-color: #FF5722; }
        .loss-high { background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%); border-color: #D32F2F; }
        .loss-extreme { background: linear-gradient(135deg, #B71C1C 0%, #8B0000 100%); border-color: #B71C1C; }
        .neutral { background: linear-gradient(135deg, #607D8B 0%, #78909C 100%); border-color: #607D8B; }
        
        .gain-extreme .ticker, .gain-extreme .change, .gain-extreme .price, .gain-extreme .market-cap,
        .gain-high .ticker, .gain-high .change, .gain-high .price, .gain-high .market-cap,
        .gain-medium .ticker, .gain-medium .change, .gain-medium .price, .gain-medium .market-cap,
        .gain-low .ticker, .gain-low .change, .gain-low .price, .gain-low .market-cap,
        .loss-low .ticker, .loss-low .change, .loss-low .price, .loss-low .market-cap,
        .loss-medium .ticker, .loss-medium .change, .loss-medium .price, .loss-medium .market-cap,
        .loss-high .ticker, .loss-high .change, .loss-high .price, .loss-high .market-cap,
        .loss-extreme .ticker, .loss-extreme .change, .loss-extreme .price, .loss-extreme .market-cap,
        .neutral .ticker, .neutral .change, .neutral .price, .neutral .market-cap {
            color: #ffffff !important;
            text-shadow: 0 0 20px rgba(0, 0, 0, 1), 3px 3px 8px rgba(0, 0, 0, 1) !important;
        }
        
        .legend {
            position: fixed;
            bottom: 5px;
            right: 15px;
            background: rgba(0, 0, 0, 0.95);
            padding: 12px;
            border-radius: 12px;
            font-size: clamp(0.6rem, 1vw, 0.75rem);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
            min-width: 150px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }
        
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .notification.show { opacity: 1; transform: translateX(0); }
        .notification.success { background: linear-gradient(45deg, #4CAF50, #66BB6A); }
        .notification.error { background: linear-gradient(45deg, #F44336, #E57373); }
        .notification.warning { background: linear-gradient(45deg, #FF9800, #FFB74D); }
        
        @media (max-width: 768px) {
            .size-mega { width: 280px; height: 180px; }
            .size-ultra-large { width: 240px; height: 160px; }
            .size-extra-large, .size-large { width: 200px; height: 140px; }
            .size-medium { width: 170px; height: 120px; }
            .size-small, .size-mini, .size-micro { width: 130px; height: 100px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">METALS TREEMAP</h1>
            
            <div class="disclaimer">
                <p>ã“ã®ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã¯ã€ç›¸å ´ã®é›°å›²æ°—ã‚„æ³¨ç›®éŠ˜æŸ„ã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã®å‚è€ƒæƒ…å ±ã§ã™ã€‚</p>
                <p>ãƒ‡ãƒ¼ã‚¿å–å¾—ã®éƒ½åˆä¸Šã€è¡¨ç¤ºãŒæ›´æ–°ã•ã‚Œãªã„æ—¥ã‚„ä¸€éƒ¨æƒ…å ±ãŒæ¬ ã‘ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
                <p>ã‚ã‚‰ã‹ã˜ã‚ã”äº†æ‰¿ãã ã•ã„ã€‚<span class="signature">omusubi</span></p>
            </div>
            
            <div class="controls">
                <div class="period-buttons">
                    <button class="period-btn active" data-period="daily" onclick="changePeriod('daily')">ğŸ“… æ—¥æ¬¡</button>
                    <button class="period-btn" data-period="week" onclick="changePeriod('week')">ğŸ“ˆ é€±æ¬¡</button>
                    <button class="period-btn" data-period="month" onclick="changePeriod('month')">ğŸ“Š æœˆæ¬¡</button>
                    <button class="period-btn" data-period="3month" onclick="changePeriod('3month')">ğŸ“† 3ãƒ¶æœˆ</button>
                    <button class="period-btn" data-period="year" onclick="changePeriod('year')">ğŸ“… 1å¹´</button>
                </div>
                
                <div class="data-warning" id="dataWarning" style="display: none;">
                    <!-- å‹•çš„ã«è¡¨ç¤º -->
                </div>
            </div>
            
            <div class="last-update">
                æœ€çµ‚æ›´æ–°: <span id="lastUpdate">-</span> | 
                è¡¨ç¤ºæœŸé–“: <span id="currentPeriod">æ—¥æ¬¡</span> |
                ç·æ™‚ä¾¡ç·é¡: <span id="marketCapStats">-</span>
            </div>
            
            <!-- å¸‚å ´é–‹å ´æ™‚é–“è¡¨ç¤º -->
            <div class="market-hours">
                <div class="market-hours-title">ğŸŒ ä¸–ç•Œå¸‚å ´é–‹å ´æ™‚é–“</div>
                <div class="market-hours-info" id="marketHoursInfo"></div>
                <div class="market-hours-chart">
                    <div class="market-hours-header">
                        <div class="market-name">å¸‚å ´</div>
                        <div class="hours-grid" id="hoursGrid">
                            <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="market-row">
                        <div class="market-info">
                            <span class="flag">ğŸ‡ºğŸ‡¸</span>
                            <span class="market-name">ç±³å›½</span>
                        </div>
                        <div class="hours-bar us-hours" id="usHours"></div>
                    </div>
                    <div class="market-row">
                        <div class="market-info">
                            <span class="flag">ğŸ‡¨ğŸ‡¦</span>
                            <span class="market-name">ã‚«ãƒŠãƒ€</span>
                        </div>
                        <div class="hours-bar ca-hours" id="caHours"></div>
                    </div>
                    <div class="market-row">
                        <div class="market-info">
                            <span class="flag">ğŸ‡¦ğŸ‡º</span>
                            <span class="market-name">ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢</span>
                        </div>
                        <div class="hours-bar au-hours" id="auHours"></div>
                    </div>
                    <div class="market-row">
                        <div class="market-info">
                            <span class="flag">ğŸ‡¯ğŸ‡µ</span>
                            <span class="market-name">æ—¥æœ¬</span>
                        </div>
                        <div class="hours-bar jp-hours" id="jpHours"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="metals-treemap">
            <div class="metal-section gold-section">
                <div class="metal-header">
                    <div class="metal-icon">ğŸ¥‡</div>
                    <div class="metal-title">GOLD</div>
                    <div class="metal-subtitle">é‡‘é–¢é€£éŠ˜æŸ„ (93éŠ˜æŸ„)</div>
                    <button class="sort-btn" data-section="gold" data-sort-type="changePercent" title="ï¼…ä¸Šæ˜‡ç‡é †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“ˆ</span>
                        <span class="sort-text">ï¼…ä¸Šæ˜‡ç‡é †</span>
                    </button>
                    <button class="sort-btn" data-section="gold" data-sort-type="rsi" title="RSIé †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“Š</span>
                        <span class="sort-text">RSIé †</span>
                    </button>
                </div>
                <div class="tiles-container" id="goldContainer"></div>
            </div>
            
            <div class="metal-section silver-section">
                <div class="metal-header">
                    <div class="metal-icon">ğŸ¥ˆ</div>
                    <div class="metal-title">SILVER</div>
                    <div class="metal-subtitle">éŠ€é–¢é€£éŠ˜æŸ„ (26éŠ˜æŸ„)</div>
                    <button class="sort-btn" data-section="silver" data-sort-type="changePercent" title="ï¼…ä¸Šæ˜‡ç‡é †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“ˆ</span>
                        <span class="sort-text">ï¼…ä¸Šæ˜‡ç‡é †</span>
                    </button>
                    <button class="sort-btn" data-section="silver" data-sort-type="rsi" title="RSIé †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“Š</span>
                        <span class="sort-text">RSIé †</span>
                    </button>
                </div>
                <div class="tiles-container" id="silverContainer"></div>
            </div>
            
            <div class="metal-section copper-section">
                <div class="metal-header">
                    <div class="metal-icon">ğŸ§±</div>
                    <div class="metal-title">COPPER</div>
                    <div class="metal-subtitle">éŠ…é–¢é€£éŠ˜æŸ„ (12éŠ˜æŸ„)</div>
                    <button class="sort-btn" data-section="copper" data-sort-type="changePercent" title="ï¼…ä¸Šæ˜‡ç‡é †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“ˆ</span>
                        <span class="sort-text">ï¼…ä¸Šæ˜‡ç‡é †</span>
                    </button>
                    <button class="sort-btn" data-section="copper" data-sort-type="rsi" title="RSIé †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“Š</span>
                        <span class="sort-text">RSIé †</span>
                    </button>
                </div>
                <div class="tiles-container" id="copperContainer"></div>
            </div>
            
            <div class="metal-section fertilizer-section">
                <div class="metal-header">
                    <div class="metal-icon">ğŸŒ±</div>
                    <div class="metal-title">FERTILIZER</div>
                    <div class="metal-subtitle">è‚¥æ–™é–¢é€£éŠ˜æŸ„ (3éŠ˜æŸ„)</div>
                    <button class="sort-btn" data-section="fertilizer" data-sort-type="changePercent" title="ï¼…ä¸Šæ˜‡ç‡é †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“ˆ</span>
                        <span class="sort-text">ï¼…ä¸Šæ˜‡ç‡é †</span>
                    </button>
                    <button class="sort-btn" data-section="fertilizer" data-sort-type="rsi" title="RSIé †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“Š</span>
                        <span class="sort-text">RSIé †</span>
                    </button>
                </div>
                <div class="tiles-container" id="fertilizerContainer"></div>
            </div>
            
            <div class="metal-section platinum-section">
                <div class="metal-header">
                    <div class="metal-icon">ğŸ’</div>
                    <div class="metal-title">PLATINUM/PGM</div>
                    <div class="metal-subtitle">ãƒ—ãƒ©ãƒãƒŠãƒ»PGMé–¢é€£éŠ˜æŸ„ (4éŠ˜æŸ„)</div>
                    <button class="sort-btn" data-section="platinum" data-sort-type="changePercent" title="ï¼…ä¸Šæ˜‡ç‡é †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“ˆ</span>
                        <span class="sort-text">ï¼…ä¸Šæ˜‡ç‡é †</span>
                    </button>
                    <button class="sort-btn" data-section="platinum" data-sort-type="rsi" title="RSIé †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“Š</span>
                        <span class="sort-text">RSIé †</span>
                    </button>
                </div>
                <div class="tiles-container" id="platinumContainer"></div>
            </div>
            
            <div class="metal-section lithium-section">
                <div class="metal-header">
                    <div class="metal-icon">ğŸ”‹</div>
                    <div class="metal-title">LITHIUM</div>
                    <div class="metal-subtitle">ãƒªãƒã‚¦ãƒ é–¢é€£éŠ˜æŸ„</div>
                    <button class="sort-btn" data-section="lithium" data-sort-type="changePercent" title="ï¼…ä¸Šæ˜‡ç‡é †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“ˆ</span>
                        <span class="sort-text">ï¼…ä¸Šæ˜‡ç‡é †</span>
                    </button>
                    <button class="sort-btn" data-section="lithium" data-sort-type="rsi" title="RSIé †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“Š</span>
                        <span class="sort-text">RSIé †</span>
                    </button>
                </div>
                <div class="tiles-container" id="lithiumContainer"></div>
            </div>
            
            <div class="metal-section uranium-section">
                <div class="metal-header">
                    <div class="metal-icon">â˜¢ï¸</div>
                    <div class="metal-title">URANIUM</div>
                    <div class="metal-subtitle">ã‚¦ãƒ©ãƒ³é–¢é€£éŠ˜æŸ„</div>
                    <button class="sort-btn" data-section="uranium" data-sort-type="changePercent" title="ï¼…ä¸Šæ˜‡ç‡é †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“ˆ</span>
                        <span class="sort-text">ï¼…ä¸Šæ˜‡ç‡é †</span>
                    </button>
                    <button class="sort-btn" data-section="uranium" data-sort-type="rsi" title="RSIé †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“Š</span>
                        <span class="sort-text">RSIé †</span>
                    </button>
                </div>
                <div class="tiles-container" id="uraniumContainer"></div>
            </div>
            
            <div class="metal-section nickel-section">
                <div class="metal-header">
                    <div class="metal-icon">âš™ï¸</div>
                    <div class="metal-title">NICKEL</div>
                    <div class="metal-subtitle">ãƒ‹ãƒƒã‚±ãƒ«é–¢é€£éŠ˜æŸ„</div>
                    <button class="sort-btn" data-section="nickel" data-sort-type="changePercent" title="ï¼…ä¸Šæ˜‡ç‡é †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“ˆ</span>
                        <span class="sort-text">ï¼…ä¸Šæ˜‡ç‡é †</span>
                    </button>
                    <button class="sort-btn" data-section="nickel" data-sort-type="rsi" title="RSIé †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“Š</span>
                        <span class="sort-text">RSIé †</span>
                    </button>
                </div>
                <div class="tiles-container" id="nickelContainer"></div>
            </div>
            
            <div class="metal-section ree-section">
                <div class="metal-header">
                    <div class="metal-icon">ğŸ§²</div>
                    <div class="metal-title">REE</div>
                    <div class="metal-subtitle">ãƒ¬ã‚¢ã‚¢ãƒ¼ã‚¹é–¢é€£éŠ˜æŸ„</div>
                    <button class="sort-btn" data-section="ree" data-sort-type="changePercent" title="ï¼…ä¸Šæ˜‡ç‡é †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“ˆ</span>
                        <span class="sort-text">ï¼…ä¸Šæ˜‡ç‡é †</span>
                    </button>
                    <button class="sort-btn" data-section="ree" data-sort-type="rsi" title="RSIé †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“Š</span>
                        <span class="sort-text">RSIé †</span>
                    </button>
                </div>
                <div class="tiles-container" id="reeContainer"></div>
            </div>
            
            <div class="metal-section titanium-section">
                <div class="metal-header">
                    <div class="metal-icon">ğŸ›©ï¸</div>
                    <div class="metal-title">TITANIUM</div>
                    <div class="metal-subtitle">ãƒã‚¿ãƒ³é–¢é€£éŠ˜æŸ„</div>
                    <button class="sort-btn" data-section="titanium" data-sort-type="changePercent" title="ï¼…ä¸Šæ˜‡ç‡é †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“ˆ</span>
                        <span class="sort-text">ï¼…ä¸Šæ˜‡ç‡é †</span>
                    </button>
                    <button class="sort-btn" data-section="titanium" data-sort-type="rsi" title="RSIé †ã§ä¸¦ã¹æ›¿ãˆ">
                        <span class="sort-icon">ğŸ“Š</span>
                        <span class="sort-text">RSIé †</span>
                    </button>
                </div>
                <div class="tiles-container" id="titaniumContainer"></div>
            </div>
        </div>
        
        <div class="legend" id="colorLegend">
            <div class="legend-item"><div class="legend-color gain-extreme"></div><span id="legend-gain-extreme">+20%+</span></div>
            <div class="legend-item"><div class="legend-color gain-high"></div><span id="legend-gain-high">+4%+</span></div>
            <div class="legend-item"><div class="legend-color gain-medium"></div><span id="legend-gain-medium">+2~4%</span></div>
            <div class="legend-item"><div class="legend-color gain-low"></div><span id="legend-gain-low">0~+2%</span></div>
            <div class="legend-item"><div class="legend-color loss-low"></div><span id="legend-loss-low">0~-2%</span></div>
            <div class="legend-item"><div class="legend-color loss-medium"></div><span id="legend-loss-medium">-2~-5%</span></div>
            <div class="legend-item"><div class="legend-color loss-high"></div><span id="legend-loss-high">-5%-</span></div>
            <div class="legend-item"><div class="legend-color loss-extreme"></div><span id="legend-loss-extreme">-20%-</span></div>
        </div>
    </div>
    
    <script>
        let currentPeriod = 'daily';
        let isUpdating = false;
        let stocksData = [];
        let ipoSymbolsInfo = {};
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨: ã‚µãƒ¼ãƒãƒ¼APIã¯ä½¿ç”¨ã›ãšã€ç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
        const DATA_PATH = 'data/joined';
        
        const metalSymbols = {
            gold: ['NEM', 'B', 'AEM', 'KGC', 'IAG', 'MUX', 'SSRM', 'WPM', 'GDX', 'GDXJ', 'NUGT', '2036', 'ARMN', 'BTG', 'NFGC', 'PPTA', 'USAU', 'AUMB', 'LG', 'OMI', 'TSK', 'AUMBF', 'LGCXF', 'TSKFF', 'ASE', 'CERT', 'DNRSF', 'HSTR', 'ITR', 'JAG', 'MSA', 'NEXG', 'NOM', 'ORE', 'PZG', 'RVG', 'RUA', 'STLR', 'SGO', 'WRLG', 'ALK', 'AAUC', 'AMX', 'ARIS', 'ORA', 'AUC', 'BGD', 'BGL', 'BC8', 'BOGO', 'BTR', 'CBR', 'CEL', 'CKG', 'FVL', 'GMIN', 'GAU', 'GGO', 'GGR', 'THM', 'LUCA', 'MKO', 'MAE', 'MFG', 'MAU', 'NFG', 'NCX', 'PGLD', 'PRU', 'RIO', 'STN', 'SCOT', 'SICO', 'STGO', 'TSO', 'TAU', 'THX', 'TXG', 'VAU', 'WGX', 'WGO'],
            silver: ['AAG', 'USA', 'APM', 'ASL', 'ASM', 'AYA', 'BNKR', 'DSV', 'EXK', 'AG', 'GRSL', 'GGD', 'GSVR', 'HOC', 'MMA', 'PAAS', 'SCZ', 'AGMR', 'SVRS', 'SLVR', 'SILV', 'SKE', 'SS1', 'VZLA', 'HL', 'CDE', 'IVR', 'SVM', 'SLV', 'SIL', '1542', '1673'],
            copper: ['FCX', 'SCCO', 'TECK', 'BHP', 'RIO_CU', 'ERO', 'COPX', 'ICOP', 'PPP', 'BMM', 'TMQ'],
            fertilizer: ['NTR', 'MOS', 'IPI'],
            platinum: ['SBSW', 'PLG', '1541', '1674'],
            lithium: ['ALB', 'LAC', 'SQM', 'LAR', 'SGML', 'LIT', 'CRML'],
            uranium: ['CCJ', 'NXE', 'DNN', 'UEC', 'LEU', 'URA', 'UUUU', 'OKLO', 'SMR'],
            nickel: ['VALE'],
            ree: ['MP', 'REMX', 'AII'],
            titanium: ['IPX', 'TROX']
        };
        
        const allSymbols = Object.values(metalSymbols).flat();
        
        // æœ‰åäººè©•ä¾¡ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆè©•ä¾¡ãŒã¤ã„ã¦ã„ã‚‹éŠ˜æŸ„ã®ã¿ï¼‰
        const celebrityGrades = {
            // éŠ€ã‚»ã‚¯ã‚¿ãƒ¼ï¼ˆæ›´æ–°ç‰ˆï¼‰
            'AAG': 'B',      // Aftermath Silver
            'USA': 'B+',     // Americas Gold & Silver Corp
            'APM': 'B+',     // Andean Precious Metals Corp (æ–°è¦è¿½åŠ )
            'ASL': 'B+',     // Andean Silver Ltd (æ–°è¦è¿½åŠ )
            'ASM': 'A-',     // Avino Silver & Gold Mines Ltd
            'AYA': 'A-',     // Aya Gold & Silver Inc
            'BNKR': 'B',     // Bunker Hill Mining Corp
            'DSV': 'B+',     // Discovery Silver Corp
            'EXK': 'A-',     // Endeavour Silver Corp
            'AG': 'A-',      // First Majestic Silver Corp
            'GRSL': 'B',     // GR Silver Mining Ltd (æ–°è¦è¿½åŠ )
            'GGD': 'B+',     // Gogold Resources (æ–°è¦è¿½åŠ )
            'GSVR': 'B-',    // Guanajuato Silver
            'MMA': 'B',      // Maronan Metals Ltd (æ–°è¦è¿½åŠ )
            'PAAS': 'A',     // Pan American Silver Corp
            'SCZ': 'B+',     // Santacruz Silver Mining Ltd
            'AGMR': 'B',     // Silver Mountain Resources Inc (æ–°è¦è¿½åŠ )
            'SVRS': 'B',     // Silver Storm Mining Ltd (æ–°è¦è¿½åŠ )
            'SLVR': 'B+',    // Silver Tiger Metals (æ–°è¦è¿½åŠ )
            'SILV': 'B+',    // Silvercorp Metals Inc
            'SKE': 'B+',     // Skeena Gold & Silver (æ–°è¦è¿½åŠ )
            'SS1': 'B-',     // Sun Silver Ltd (æ–°è¦è¿½åŠ )
            'VZLA': 'A-',    // Vizsla Silver Corp
            'SVM': 'B+',     // Silvercorp Metals Inc
            // æ—¢å­˜ã®éŠ€éŠ˜æŸ„
            'HL': 'B+',
            'CDE': 'B',
            'IVR': 'B-',
            // ãã®ä»–ã®ã‚»ã‚¯ã‚¿ãƒ¼ï¼ˆGoldï¼‰
            'AUMB': 'A-',    // 1911 Gold Corp
            'ASE': 'B',      // Asante Gold Corp
            'CERT': 'B',     // Cerrado Gold Inc
            'DNRSF': 'B-',   // Denarius Metals (DNRã‹ã‚‰DNRSFã«å¤‰æ›´)
            'HSTR': 'B+',    // Heliostar Metals Ltd (B â†’ B+)
            'ITR': 'B',      // Integra Resources (B+ â†’ B)
            'JAG': 'B+',     // Jaguar Mining Inc
            'MSA': 'B+',     // Mineros S.A.
            'NEXG': 'A-',    // NexGold Mining Corp
            'ORE': 'B-',     // Orezono Gold Corp
            'PZG': 'B',      // Paramount Gold Nevada Corp
            'RVG': 'B+',     // Revival Gold Inc
            'RUA': 'B',      // Rua Gold Inc
            'STLR': 'B',     // STLLR Gold
            'AGX': 'B-',     // Silver X Mining
            'SGO': 'B',      // Sonoro Gold Corp
            'TSK': 'B',      // Talisker Resources Ltd
            'WRLG': 'B+',    // West Red Lake Gold Mines Inc
            'OMI': 'B',      // Orosur Mining Inc
            'PPTA': 'B+',    // Perpetua Resources Corp
            'USAU': 'B+',    // US Gold Corp
            'SSRM': 'B+',    // SSR Mining Inc
            // Goldã‚»ã‚¯ã‚¿ãƒ¼æ–°è¦è¿½åŠ 
            'ALK': 'B',      // Alkane Resources Ltd
            'AAUC': 'B+',    // Allied Gold Corp
            'AMX': 'B',      // Amex Exploration Inc
            'ARIS': 'A-',    // Aris Mining Corp
            'ORA': 'B+',     // Aura Minerals Inc
            'AUC': 'B+',     // Ausgold Ltd
            'BGD': 'B',      // Barton Gold Ltd
            'BGL': 'B+',     // Bellevue Gold
            'BC8': 'B+',     // Black Cat Syndicate Ltd
            'BOGO': 'B',     // Borealis Mining Company Ltd (æ­£å¼ãƒ†ã‚£ãƒƒã‚«ãƒ¼: BOGO)
            'BTR': 'B',      // Brightstar Resources Ltd
            'CBR': 'B',      // Cabral Gold
            'CEL': 'B',      // Challenger Gold
            'CKG': 'B',      // Chesapeake Gold Corp
            'FVL': 'A-',     // Freegold Ventures Ltd
            'GMIN': 'B+',    // G Mining Ventures Corp
            'GAU': 'B',      // Galiano Gold Inc
            'GGO': 'B',      // Galleon Gold Corp
            'GGR': 'B+',     // Greatland Resources Ltd
            'THM': 'B',      // Intl. Tower Hill Mines Ltd
            'LUCA': 'B',     // Luca Mining
            'MKO': 'B+',     // Mako Mining Corp
            'MAE': 'B',      // Maritime Resources Corp
            'MFG': 'B',      // Mayfair Gold Corp
            'MAU': 'B+',     // Montage Gold Corp
            'NFG': 'B',      // New Found Gold Corp
            'NCX': 'B+',     // Northisle Copper & Gold Inc
            'PGLD': 'B',     // P2 Gold Inc
            'PRU': 'A-',     // Perseus Mining Ltd
            'RIO': 'B',      // Rio2 Ltd (Gold)
            'STN': 'B',      // Saturn Metals Ltd
            'SCOT': 'B',     // Scottie Resources
            'SICO': 'B',     // Silverco Mining Ltd
            'STGO': 'B-',    // Steppe Gold Ltd
            'TSO': 'B',      // Tesoro Gold
            'TAU': 'B',      // Thesis Gold Inc
            'THX': 'B',      // Thor Explorations Ltd
            'TXG': 'A-',     // Torex Gold Resources Inc
            'VAU': 'A-',     // Vault Minerals
            'WGX': 'A-',     // Westgold Resources Ltd
            'WGO': 'B'       // White Gold Corp
        };
        
        // ä¼æ¥­åãƒãƒƒãƒ”ãƒ³ã‚°
        const companyNames = {
            // ğŸ‡¨ğŸ‡¦ ã‚«ãƒŠãƒ€ï¼ˆTSX / TSXVï¼‰- éŠ€ã‚»ã‚¯ã‚¿ãƒ¼
            'AAG': 'Aftermath Silver',
            'USA': 'Americas Gold & Silver Corp',
            'APM': 'Andean Precious Metals Corp',
            'ASL': 'Andean Silver Ltd',  // ASR â†’ ASLã«æ›´æ–°
            'ASM': 'Avino Silver & Gold Mines Ltd',
            'AYA': 'Aya Gold & Silver Inc',
            'DSV': 'Discovery Silver Corp',
            'GRSL': 'GR Silver Mining Ltd',
            'GGD': 'Gogold Resources',
            'GSVR': 'Guanajuato Silver',
            'MMA': 'Maronan Metals Ltd',  // MAR â†’ MMAã«æ›´æ–°
            'SCZ': 'Santacruz Silver Mining Ltd',
            'AGMR': 'Silver Mountain Resources Inc',
            'SVRS': 'Silver Storm Mining Ltd',
            'SLVR': 'Silver Tiger Metals',
            'SKE': 'Skeena Gold & Silver',
            'SS1': 'Sun Silver Ltd',  // SUNS â†’ SS1ã«æ›´æ–°
            'VZLA': 'Vizsla Silver Corp',
            
            // ãã®ä»–ã®éŠ€éŠ˜æŸ„
            'BNKR': 'Bunker Hill Mining Corp',  // BHLL â†’ BNKRã«æ›´æ–°
            'EXK': 'Endeavour Silver Corp',
            'AG': 'First Majestic Silver Corp',
            'PAAS': 'Pan American Silver Corp',
            'SILV': 'Silvercorp Metals Inc',
            'HL': 'Hecla Mining Company',
            'CDE': 'Coeur Mining',
            'IVR': 'Invesco Mortgage Capital Inc',
            'SVM': 'Silvercorp Metals Inc',
            'SS1': 'Sun Silver Ltd',
            
            // ğŸ‡¨ğŸ‡¦ ã‚«ãƒŠãƒ€ï¼ˆTSX / TSXVï¼‰- é‡‘ã‚»ã‚¯ã‚¿ãƒ¼
            'TSK': 'Talisker Resources Ltd',
            'LG': 'Lahontan Gold Corp',
            'OMI': 'Orosur Mining Inc',
            'AUMB': '1911 Gold Corporation (TSXV:AUMB)',
            'AUMBF': '1911 Gold Corporation (OTCQX:AUMBF)',
            'LGCXF': 'Omai Gold Mines Corp (OTCQX:LGCXF)',
            'TSKFF': 'Talisker Resources Ltd (OTCQX:TSKFF)',
            
            // ğŸ‡¦ğŸ‡º ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ï¼ˆASXï¼‰
            'MMA': 'Maronan Metals Ltd',
            
            // ğŸ‡¨ğŸ‡¦ é‡‘ã‚»ã‚¯ã‚¿ãƒ¼ãã®ä»–
            'ASE': 'Asante Gold Corp',
            'PPTA': 'Perpetua Resources Corp',
            'USAU': 'US Gold Corp',
            'SSRM': 'SSR Mining Inc',
            'CERT': 'Cerrado Gold Inc',
            'DNR': 'Denarius Metals',
            'DNRSF': 'Denarius Metals',
            'HSTR': 'Heliostar Metals Ltd',
            'ITR': 'Integra Resources',
            'JAG': 'Jaguar Mining Inc',
            'MSA': 'Mineros S.A.',
            'NEXG': 'NexGold Mining Corp',
            'ORE': 'Orezono Gold Corp',
            'PZG': 'Paramount Gold Nevada Corp',
            'RVG': 'Revival Gold Inc',
            'RUA': 'Rua Gold Inc',
            'STLR': 'STLLR Gold',
            'AGX': 'Silver X Mining',
            'SGO': 'Sonoro Gold Corp',
            'WRLG': 'West Red Lake Gold Mines Inc',
            // Goldã‚»ã‚¯ã‚¿ãƒ¼æ–°è¦è¿½åŠ ï¼ˆã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ASXï¼‰
            'ALK': 'Alkane Resources Ltd',
            'AUC': 'Ausgold Ltd',
            'BGD': 'Barton Gold Ltd',
            'BGL': 'Bellevue Gold',
            'BC8': 'Black Cat Syndicate Ltd',
            'BTR': 'Brightstar Resources Ltd',
            'CEL': 'Challenger Gold',
            'STN': 'Saturn Metals Ltd',
            'TSO': 'Tesoro Gold',
            'VAU': 'Vault Minerals',
            'WGX': 'Westgold Resources Ltd',
            // Goldã‚»ã‚¯ã‚¿ãƒ¼æ–°è¦è¿½åŠ ï¼ˆã‚«ãƒŠãƒ€TSXï¼‰
            'AAUC': 'Allied Gold Corp',
            'ARIS': 'Aris Mining Corp',
            'ORA': 'Aura Minerals Inc',
            'FVL': 'Freegold Ventures Ltd',
            'GMIN': 'G Mining Ventures Corp',
            'GAU': 'Galiano Gold Inc',
            'MAU': 'Montage Gold Corp',
            'PRU': 'Perseus Mining Ltd',
            'RIO': 'Rio2 Ltd',
            'STGO': 'Steppe Gold Ltd',
            'TXG': 'Torex Gold Resources Inc',
            // Goldã‚»ã‚¯ã‚¿ãƒ¼æ–°è¦è¿½åŠ ï¼ˆã‚«ãƒŠãƒ€TSX-Vï¼‰
            'AMX': 'Amex Exploration Inc',
            'BOGO': 'Borealis Mining Company Ltd',
            'CBR': 'Cabral Gold',
            'CKG': 'Chesapeake Gold Corp',
            'GGO': 'Galleon Gold Corp',
            'LUCA': 'Luca Mining',
            'MKO': 'Mako Mining Corp',
            'MAE': 'Maritime Resources Corp',
            'MFG': 'Mayfair Gold Corp',
            'NFG': 'New Found Gold Corp',
            'NCX': 'Northisle Copper & Gold Inc',
            'PGLD': 'P2 Gold Inc',
            'SCOT': 'Scottie Resources',
            'SICO': 'Silverco Mining Ltd',
            'TAU': 'Thesis Gold Inc',
            'THX': 'Thor Explorations Ltd',
            'WGO': 'White Gold Corp',
            // Goldã‚»ã‚¯ã‚¿ãƒ¼æ–°è¦è¿½åŠ ï¼ˆãã®ä»–ï¼‰
            'GGR': 'Greatland Resources Ltd',
            'THM': 'Intl. Tower Hill Mines Ltd',
            
            // ğŸ‡ºğŸ‡¸ ç±³å›½ãƒ»ãã®ä»–
            'AEM': 'Agnico Eagle Mines Limited',
            'AII': 'American International Industries Inc.',
            'ALB': 'Albemarle Corporation',
            'ARMN': 'Aramark',
            'B': 'Brookfield Corporation',
            'BHP': 'BHP Group Limited',
            'BTG': 'B2Gold Corp.',
            'CCJ': 'Cameco Corporation',
            'COPX': 'Global X Copper Miners ETF',
            'CRML': 'Critical Elements Lithium Corporation',
            'DNN': 'Denison Mines Corp.',
            'ERO': 'Ero Copper Corp.',
            'FCX': 'Freeport-McMoRan Inc.',
            'GDX': 'VanEck Vectors Gold Miners ETF',
            'GDXJ': 'VanEck Vectors Junior Gold Miners ETF',
            'IAG': 'IAMGOLD Corporation',
            'ICOP': 'IC Potash Corp.',
            'IPI': 'Intrepid Potash, Inc.',
            'IPX': 'IperionX Limited',
            'KGC': 'Kinross Gold Corporation',
            'LAC': 'Lithium Americas Corp.',
            'LAR': 'Laramide Resources Ltd.',
            'LEU': 'Centrus Energy Corp.',
            'LIT': 'Global X Lithium & Battery Tech ETF',
            'MOS': 'The Mosaic Company',
            'MP': 'MP Materials Corp.',
            'MUX': 'McEwen Mining Inc.',
            'NEM': 'Newmont Corporation',
            'NFGC': 'New Found Gold Corp.',
            'NTR': 'Nutrien Ltd.',
            'NUGT': 'Direxion Daily Gold Miners Bull 3x Shares ETF',
            'NXE': 'NexGen Energy Ltd.',
            'OKLO': 'Oklo Resources Ltd.',
            'PAAS': 'Pan American Silver Corp.',
            'PLG': 'Platinum Group Metals Ltd.',
            'PPTA': 'Perpetua Resources Corp.',
            'REMX': 'VanEck Rare Earth/Strategic Metals ETF',
            'RIO_CU': 'Rio Tinto Group',
            'SBSW': 'Sibanye Stillwater Limited',
            'SCCO': 'Southern Copper Corporation',
            // Copperã‚»ã‚¯ã‚¿ãƒ¼æ–°è¦è¿½åŠ ï¼ˆKCDã¯å‰Šé™¤ - ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸å¯ï¼‰
            'PPP': 'Prospector Metals',
            'BMM': 'Black Mammoth Metals',
            'TMQ': 'Trilogy Metals',
            'SGML': 'Sigma Lithium Corporation',
            'SIL': 'Global X Silver Miners ETF',
            'SKE': 'Skeena Resources Ltd.',
            'SLV': 'iShares Silver Trust ETF',
            'SLVR': 'Silver Tiger Metals Inc.',
            'SMR': 'Small Modular Reactor Corp.',
            'SQM': 'Sociedad QuÃ­mica y Minera de Chile',
            'SSRM': 'SSR Mining Inc.',
            'TECK': 'Teck Resources Limited',
            'TROX': 'Tronox Holdings plc',
            'UEC': 'Uranium Energy Corp.',
            'URA': 'Global X Uranium ETF',
            'USAU': 'U.S. Gold Corp.',
            'UUUU': 'Energy Fuels Inc.',
            'VALE': 'Vale S.A.',
            'VZLA': 'Vizsla Silver Corp.',
            'WPM': 'Wheaton Precious Metals Corp.',
            
            // ğŸ‡¯ğŸ‡µ æ—¥æœ¬
            '2036': 'NEXT NOTES é‡‘å…ˆç‰© ãƒ€ãƒ–ãƒ«ãƒ»ãƒ–ãƒ« ETN',
            '1542': 'éŠ€ç¾ç‰©é€£å‹•ETF',
            '1673': 'éŠ€ä¾¡æ ¼é€£å‹•ETFï¼ˆWisdomTreeï¼‰',
            '1541': 'ãƒ—ãƒ©ãƒãƒŠç¾ç‰©é€£å‹•ETF',
            '1674': 'ç™½é‡‘ETF'
        };
        
        // ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’å–å¾—ã™ã‚‹é–¢æ•°
        function getGradeClass(grade) {
            switch(grade) {
                case 'A': return 'grade-a';
                case 'A-': return 'grade-a-minus';
                case 'B+': return 'grade-b-plus';
                case 'B': return 'grade-b';
                case 'B-': return 'grade-b-minus';
                default: return 'grade-b';
            }
        }
        
        // ã‚°ãƒ¬ãƒ¼ãƒ‰è¡¨ç¤ºHTMLã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
        function createGradeHtml(symbol) {
            const grade = celebrityGrades[symbol];
            if (!grade) return '';
            
            const gradeClass = getGradeClass(grade);
            return `<div class="grade-label ${gradeClass}">${grade}</div>`;
        }
        
        function updateIPOWarning(period) {
            // IPOè­¦å‘Šæ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–ï¼ˆå¸¸ã«éè¡¨ç¤ºï¼‰
            const warningDiv = document.getElementById('dataWarning');
            if (warningDiv) {
                warningDiv.style.display = 'none';
            }
        }
        
        const marketCapEstimates = {
            'BHP': 120000, 'RIO': 95000, 'VALE': 55000, 'FCX': 60000, 'NEM': 45000, 'SCCO': 45000, 'B': 30000,
            'CCJ': 25000, 'AEM': 25000, 'ALB': 12000, 'NTR': 20000, 'SQM': 11000,
            'GDX': 18000, 'SLV': 15000, 'WPM': 12000, 'TECK': 10000, 'KGC': 8500, 'GDXJ': 8000, 'NXE': 8000,
            'MOS': 7500, 'SSRM': 6000, 'PAAS': 6000, 'IAG': 4000, 'SBSW': 3000, 'LAC': 2800, 'MP': 2600,
            'DNN': 2500, 'AG': 2500, 'HL': 2000, 'ERO': 1600,
            'CDE': 1500, 'UUUU': 1500, 'IPI': 1400, 'COPX': 1200, 'UEC': 1200, 'LIT': 1100, 'URA': 1000, 'LEU': 900,
            'REMX': 900, 'SIL': 800, 'PLG': 600, 'MUX': 600, 'LAR': 550, 'SGML': 500,
            'NUGT': 500, 'OKLO': 400, 'EXK': 400, 'AII': 350, 'SMR': 350, 'IPX': 300, '2036': 300,
            // Copperã‚»ã‚¯ã‚¿ãƒ¼æ–°è¦è¿½åŠ ï¼ˆæ™‚ä¾¡ç·é¡æ¨å®šå€¤ï¼‰ï¼ˆKCDã¯å‰Šé™¤ - ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸å¯ï¼‰
            'PPP': 120, 'BMM': 100, 'TMQ': 200,
            '1542': 250, '1673': 200, '1541': 150, '1674': 150,
            // Goldã‚»ã‚¯ã‚¿ãƒ¼æ–°è¦è¿½åŠ ï¼ˆæ™‚ä¾¡ç·é¡æ¨å®šå€¤ï¼‰
            'ALK': 400, 'AAUC': 600, 'AMX': 150, 'ARIS': 1200, 'ORA': 500, 'AUC': 200, 'BGD': 100,
            'BGL': 800, 'BC8': 120, 'BOGO': 80, 'BTR': 90, 'CBR': 100, 'CEL': 150, 'CKG': 300,
            'DNRSF': 200, 'FVL': 400, 'GMIN': 600, 'GAU': 350, 'GGO': 200, 'GGR': 500, 'THM': 400,
            'LUCA': 250, 'MKO': 300, 'MAE': 80, 'MFG': 200, 'MAU': 400, 'NFG': 500, 'NCX': 300,
            'PGLD': 100, 'PRU': 2000, 'RIO': 250, 'STN': 80, 'SCOT': 120, 'SICO': 150, 'STGO': 300,
            'TSO': 100, 'TAU': 200, 'THX': 400, 'TXG': 800, 'VAU': 400, 'WGX': 600, 'WGO': 200,
            'TROX': 200, 'BTG': 3500, 'ARMN': 1200, 'NFGC': 1800, 'PPTA': 600, 'USAU': 400,
            'SVM': 800, 'SKE': 700, 'VZLA': 500, 'CRML': 450,
            'AUMB': 150, 'LG': 200, 'OMI': 180, 'TSK': 300, 'AYA': 250,
            // éŠ€é–¢é€£éŠ˜æŸ„ï¼ˆæ›´æ–°ç‰ˆï¼‰
            'AAG': 100, 'USA': 150, 'APM': 120, 'ASR': 90, 'ASM': 400,
            'BNKR': 80, 'DSV': 500, 'EXK': 400, 'AG': 2500, 'GRSL': 120,
            'GGD': 350, 'GSVR': 100, 'MMA': 100, 'PAAS': 6000,
            'SCZ': 80, 'AGMR': 60, 'SVRS': 50, 'SLVR': 150, 'SILV': 800,
            'SS1': 50,
            // æ—¢å­˜ã®éŠ€éŠ˜æŸ„
            'HL': 2000, 'CDE': 1500, 'IVR': 80, 'SVM': 800,
            'SLV': 15000, 'SIL': 800, 'SS1': 50,
            // ãã®ä»–ã®éŠ˜æŸ„
            'MMA': 100, 'IVR': 80,
            // ETFéŠ˜æŸ„
            'ICOP': 200
        };
        
        function calculateTileSize(marketCap) {
            if (marketCap >= 60000) return 'mega';
            if (marketCap >= 30000) return 'ultra-large';
            if (marketCap >= 20000) return 'extra-large';
            if (marketCap >= 10000) return 'large';
            if (marketCap >= 5000) return 'medium';
            if (marketCap >= 2000) return 'small';
            if (marketCap >= 1000) return 'mini';
            return 'micro';
        }
        
        // RSIå€¤ã«åŸºã¥ãè‰²åˆ†ã‘ã‚¯ãƒ©ã‚¹ã‚’å–å¾—ã™ã‚‹é–¢æ•°
        function getRSIColorClass(rsi) {
            if (rsi === null || rsi === undefined) return 'neutral';
            if (rsi <= 30) return 'oversold';
            if (rsi >= 70) return 'overbought';
            return 'neutral';
        }
        
        // æ®µå·®ï¼ˆZãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰æ–¹å¼ï¼šSVGã¯ä¸è¦ã€CSSã‚¯ãƒ©ã‚¹ã§åˆ¶å¾¡

        function createRSIQuadrantSVG(sentiment) {
            if (!sentiment || sentiment.rsi === null) {
                return '';
            }
            
            const { x, y, color, rsi, isOverbought, isOversold, isOptimistic } = sentiment;
            
            const dotX = x * 20;
            const dotY = -y * 20;
            
            let quadrantColors = {
                topRight: isOptimistic && isOverbought ? '#ffd8d8' : '#f5f5f5',
                topLeft: isOptimistic && isOversold ? '#d6f2d6' : '#f5f5f5',
                bottomLeft: !isOptimistic && isOversold ? '#ffe6d6' : '#f5f5f5',
                bottomRight: !isOptimistic && isOverbought ? '#f5c7c7' : '#f5f5f5'
            };
            
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="-30 -30 60 60">
                    <!-- 4è±¡é™ã®èƒŒæ™¯ -->
                    <path d="M0 0 L20 -20 A28 28 0 0 1 20 20 Z" fill="${quadrantColors.topRight}" opacity="0.8"/>
                    <path d="M0 0 L-20 -20 A28 28 0 0 0 20 -20 Z" fill="${quadrantColors.topLeft}" opacity="0.8"/>
                    <path d="M0 0 L-20 20 A28 28 0 0 0 -20 -20 Z" fill="${quadrantColors.bottomLeft}" opacity="0.8"/>
                    <path d="M0 0 L20 20 A28 28 0 0 1 -20 20 Z" fill="${quadrantColors.bottomRight}" opacity="0.8"/>
                    
                    <!-- å¤–å†† -->
                    <circle r="28" fill="none" stroke="#999" stroke-width="1" opacity="0.5"/>
                    
                    <!-- ä¸­å¿ƒå†† -->
                    <circle r="8" fill="none" stroke="#666" stroke-width="1" opacity="0.4"/>
                    
                    <!-- è»¸ç·š -->
                    <line x1="-28" y1="0" x2="28" y2="0" stroke="#666" stroke-width="0.5" stroke-dasharray="1 1" opacity="0.4"/>
                    <line x1="0" y1="-28" x2="0" y2="28" stroke="#666" stroke-width="0.5" stroke-dasharray="1 1" opacity="0.4"/>
                    
                    <!-- éŠ˜æŸ„ãƒã‚¤ãƒ³ãƒˆ - ç´«è‰² -->
                    <circle cx="${dotX}" cy="${dotY}" r="4.5" fill="#9333EA" stroke="#fff" stroke-width="2" opacity="1">
                        <animate attributeName="r" values="4.5;6;4.5" dur="2s" repeatCount="indefinite"/>
                    </circle>
                    
                    <!-- RSIå€¤è¡¨ç¤º - å¤§ãã‚ -->
                    <text x="0" y="31" text-anchor="middle" font-size="12" font-weight="bold" fill="#9333EA" opacity="1">
                        ${rsi.toFixed(0)}
                    </text>
                </svg>
            `;
            
            return svg;
        }
        
        function createDynamicTile(stockData) {
            const tile = document.createElement('div');
            tile.className = 'dynamic-tile';
            tile.onclick = () => showDetails(stockData.symbol);
            
            const changeValue = stockData.changePercent;
            if (changeValue !== null && changeValue !== undefined && !isNaN(changeValue)) {
                const thresholds = {
                    'daily': { extreme: 20, high: 4, medium: 2 },
                    'week': { extreme: 30, high: 10, medium: 5 },
                    'month': { extreme: 50, high: 20, medium: 10 },
                    '3month': { extreme: 75, high: 30, medium: 15 },
                    'year': { extreme: 100, high: 50, medium: 25 }
                };
                const t = thresholds[currentPeriod] || thresholds['daily'];
                
                if (changeValue > 0) {
                    if (changeValue >= t.extreme) tile.classList.add('gain-extreme');
                    else if (changeValue >= t.high) tile.classList.add('gain-high');
                    else if (changeValue >= t.medium) tile.classList.add('gain-medium');
                    else tile.classList.add('gain-low');
                } else if (changeValue < 0) {
                    const absValue = Math.abs(changeValue);
                    if (absValue >= t.extreme) tile.classList.add('loss-extreme');
                    else if (absValue >= t.high) tile.classList.add('loss-high');
                    else if (absValue >= t.medium) tile.classList.add('loss-medium');
                    else tile.classList.add('loss-low');
                } else {
                    tile.classList.add('neutral');
                }
            } else {
                tile.classList.add('neutral');
            }
            
            // æ—¥æœ¬æ ªã®æ™‚ä¾¡ç·é¡ã‚’ãƒ‰ãƒ«æ›ç®—ï¼ˆ1ãƒ‰ãƒ« = 150å††ã§æ›ç®—ï¼‰
            const isJapaneseStock = ['2036', '1541', '1542', '1673', '1674'].includes(stockData.symbol);
            let marketCap = stockData.marketCap || marketCapEstimates[stockData.symbol] || 1000;
            if (isJapaneseStock && stockData.currency === 'JPY') {
                // å††å»ºã¦æ™‚ä¾¡ç·é¡ã‚’ãƒ‰ãƒ«æ›ç®—ï¼ˆ1ãƒ‰ãƒ« = 150å††ï¼‰
                marketCap = marketCap / 150;
            }
            const sizeClass = calculateTileSize(marketCap);
            tile.classList.add(`size-${sizeClass}`);
            
            let sectorLabel = 'CORP';
            if (['GDX', 'GDXJ', 'NUGT', 'SIL', 'SLV', 'URA', 'COPX', 'LIT', 'REMX', '2036', '1541', '1542', '1673', '1674'].includes(stockData.symbol)) {
                sectorLabel = 'ETF';
            }
            
            const changeStr = stockData.changePercent !== null && stockData.changePercent !== undefined ? 
                (stockData.changePercent >= 0 ? '+' : '') + stockData.changePercent.toFixed(2) + '%' : 'å¾…æ©Ÿä¸­';
            
            // æ—¥æœ¬æ ªã®æ™‚ä¾¡ç·é¡è¡¨ç¤ºç”¨ï¼ˆå…ƒã®å††å»ºã¦å€¤ã‚’ä½¿ç”¨ï¼‰
            const originalMarketCap = stockData.marketCap || marketCapEstimates[stockData.symbol] || 1000;
            const marketCapFormatted = stockData.marketCapFormatted || 
                (isJapaneseStock ? 
                    `Â¥${(originalMarketCap / 1000).toFixed(1)}B` : 
                    `$${(marketCap / 1000).toFixed(1)}B`);
            const metalTag = stockData.metalTag || 'N/A';
            
            const priceFormatted = stockData.priceFormatted || 
                (stockData.symbol === '2036' ? 
                    `Â¥${stockData.price ? stockData.price.toFixed(0) : '0'}` : 
                    `$${stockData.price ? stockData.price.toFixed(2) : '0.00'}`);
            
            const canvas = document.createElement('canvas');
            canvas.className = 'chart-canvas';
            tile.appendChild(canvas);
            
            // æ—¥æœ¬æ ªï¼ˆJPï¼‰ã®ãƒ©ãƒ™ãƒ«ã¯éè¡¨ç¤º
            const countryLabelHtml = (stockData.countryLabel && stockData.countryLabel !== 'JP') ? 
                `<div class="country-label">${stockData.countryLabel}</div>` : '';
            const gradeHtml = createGradeHtml(stockData.symbol);
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°ï¼ˆå¼·åŒ–ç‰ˆï¼‰
            console.log(`éŠ˜æŸ„: ${stockData.symbol}, å›½åãƒ©ãƒ™ãƒ«: ${stockData.countryLabel || 'ãªã—'}, è©•ä¾¡: ${celebrityGrades[stockData.symbol] || 'ãªã—'}`);
            
            if (stockData.countryLabel) {
                console.log(`âœ… å›½åãƒ©ãƒ™ãƒ«è¡¨ç¤º: ${stockData.symbol} -> ${stockData.countryLabel}`);
            } else {
                console.log(`âŒ å›½åãƒ©ãƒ™ãƒ«ãªã—: ${stockData.symbol}`);
            }
            
            if (celebrityGrades[stockData.symbol]) {
                console.log(`âœ… è©•ä¾¡ã‚°ãƒ¬ãƒ¼ãƒ‰è¡¨ç¤º: ${stockData.symbol} -> ${celebrityGrades[stockData.symbol]}`);
            } else {
                console.log(`âŒ è©•ä¾¡ã‚°ãƒ¬ãƒ¼ãƒ‰ãªã—: ${stockData.symbol}`);
            }
            
            // ãƒ†ã‚¹ãƒˆç”¨ï¼šTSK, LG, OMI, AUMBã«å¼·åˆ¶çš„ã«å›½åãƒ©ãƒ™ãƒ«ã‚’è¡¨ç¤º
            let testCountryLabelHtml = '';
            if (['TSK', 'LG', 'OMI', 'AUMB'].includes(stockData.symbol)) {
                testCountryLabelHtml = '<div class="country-label">CA</div>';
                console.log(`ğŸ”§ ãƒ†ã‚¹ãƒˆç”¨å›½åãƒ©ãƒ™ãƒ«å¼·åˆ¶è¡¨ç¤º: ${stockData.symbol} -> CA`);
            } else if (['HOC'].includes(stockData.symbol)) {
                testCountryLabelHtml = '<div class="country-label">GB</div>';
                console.log(`ğŸ”§ ãƒ†ã‚¹ãƒˆç”¨å›½åãƒ©ãƒ™ãƒ«å¼·åˆ¶è¡¨ç¤º: ${stockData.symbol} -> GB`);
            } else if (['MMA', 'SS1'].includes(stockData.symbol)) {
                testCountryLabelHtml = '<div class="country-label">AU</div>';
                console.log(`ğŸ”§ ãƒ†ã‚¹ãƒˆç”¨å›½åãƒ©ãƒ™ãƒ«å¼·åˆ¶è¡¨ç¤º: ${stockData.symbol} -> AU`);
            }
            
            const rsiQuadrantHtml = (stockData.rsi !== null && stockData.rsi !== undefined) ? 
                `<div class="rsi-quadrant">
                    <div class="rsi-label">RSI</div>
                    <div class="rsi-value ${getRSIColorClass(stockData.rsi)}">${Math.round(stockData.rsi)}</div>
                </div>` : '';
            
            // wobbleæƒ…å ±ã‚’å–å¾—ï¼ˆæ®µå·®ãƒ¬ãƒ™ãƒ«ï¼‰
            const wobbleLevel = stockData.wobbleLevel !== undefined ? stockData.wobbleLevel : (stockData.crackLevel !== undefined ? stockData.crackLevel : 0);
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šwobble_levelã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ï¼ˆç¢ºèªç”¨ï¼‰
            if (wobbleLevel > 0) {
                console.log(`ğŸ” ${stockData.symbol}: wobble_level=${wobbleLevel}, totalScore=${stockData.crackTotalScore || 0}`);
            }
            
            // æ®µå·®ã‚¯ãƒ©ã‚¹ã¯è¿½åŠ ã—ãªã„ï¼ˆè¦–è¦šçš„ãªå·®ã‚’è¡¨ç¤ºã—ãªã„ãŸã‚ï¼‰
            
            tile.innerHTML += `
                <div class="sector-label">${sectorLabel}</div>
                <div class="metal-tag">${metalTag}</div>
                ${countryLabelHtml || testCountryLabelHtml}
                ${gradeHtml}
                ${rsiQuadrantHtml}
                <div class="tile-content">
                    <div class="ticker">${stockData.symbol}</div>
                    <div class="price">${priceFormatted}</div>
                    <div class="change">${changeStr}</div>
                    <div class="market-cap">${marketCapFormatted}</div>
                </div>
            `;
            
            setTimeout(() => {
                if (stockData.historicalPrices && stockData.historicalPrices.length > 1) {
                    const useWhiteChart = tile.className.includes('gain-');
                    drawMiniChart(canvas, stockData.historicalPrices, stockData.changePercent, useWhiteChart);
                } else {
                    drawPlaceholderChart(canvas, stockData.changePercent);
                }
            }, 100);
            
            return tile;
        }
        
        function drawPlaceholderChart(canvas, changePercent) {
            const ctx = canvas.getContext('2d');
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            const padding = 10;
            const startX = padding;
            const endX = canvas.width - padding;
            const midY = canvas.height / 2;
            const amplitude = canvas.height / 4;
            
            let lineColor = changePercent > 0 ? 'rgba(0, 255, 0, 1)' : 'rgba(255, 87, 34, 1)';
            
            ctx.beginPath();
            ctx.strokeStyle = lineColor;
            ctx.lineWidth = 4;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            
            if (changePercent > 0) {
                ctx.moveTo(startX, midY + amplitude);
                ctx.lineTo(canvas.width / 2, midY);
                ctx.lineTo(endX, midY - amplitude);
            } else {
                ctx.moveTo(startX, midY - amplitude);
                ctx.lineTo(canvas.width / 2, midY);
                ctx.lineTo(endX, midY + amplitude);
            }
            ctx.stroke();
        }
        
        function drawMiniChart(canvas, prices, changePercent, useWhiteChart = false) {
            if (!canvas || !canvas.parentElement) return;
            
            const ctx = canvas.getContext('2d');
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            if (prices.length < 2) return;
            
            const values = prices.map(p => p.close);
            const minPrice = Math.min(...values);
            const maxPrice = Math.max(...values);
            const priceRange = maxPrice - minPrice || 1;
            
            const padding = 10;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;
            const lineWidth = canvas.width < 150 ? 8 : 6;
            
            let lineColor, outlineColor;
            
            if (useWhiteChart) {
                lineColor = changePercent > 10 ? 'rgba(255, 255, 255, 1)' : 
                           changePercent > 5 ? 'rgba(0, 255, 255, 1)' : 
                           'rgba(255, 255, 255, 0.95)';
                outlineColor = 'rgba(0, 0, 0, 0.9)';
            } else {
                lineColor = changePercent > 10 ? 'rgba(0, 255, 0, 1)' : 
                           changePercent > 0 ? 'rgba(76, 175, 80, 1)' : 
                           changePercent > -10 ? 'rgba(255, 140, 0, 1)' : 
                           'rgba(255, 60, 0, 1)';
                outlineColor = 'rgba(255, 255, 255, 0.8)';
            }
            
            ctx.beginPath();
            ctx.strokeStyle = outlineColor;
            ctx.lineWidth = lineWidth + 4;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            
            prices.forEach((point, index) => {
                const x = padding + (index / (prices.length - 1)) * chartWidth;
                const y = padding + chartHeight - ((point.close - minPrice) / priceRange) * chartHeight;
                index === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            });
            ctx.stroke();
            
            ctx.beginPath();
            ctx.strokeStyle = lineColor;
            ctx.lineWidth = lineWidth;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            
            prices.forEach((point, index) => {
                const x = padding + (index / (prices.length - 1)) * chartWidth;
                const y = padding + chartHeight - ((point.close - minPrice) / priceRange) * chartHeight;
                index === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            });
            ctx.stroke();
            
            ctx.lineTo(padding + chartWidth, padding + chartHeight);
            ctx.lineTo(padding, padding + chartHeight);
            ctx.closePath();
            ctx.fillStyle = lineColor.replace('1)', '0.35)');
            ctx.fill();
        }
        
        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ã®ä¸¦ã¹æ›¿ãˆçŠ¶æ…‹ã‚’ç®¡ç†ï¼ˆ'marketCap' = æ™‚ä¾¡ç·é¡é †, 'changePercent' = ä¸Šæ˜‡ç‡é †, 'rsi' = RSIé †, 'asc' = æ˜‡é †, 'desc' = é™é †ï¼‰
        const sectionSortState = {
            gold: { mode: 'marketCap', order: 'desc' },
            silver: { mode: 'marketCap', order: 'desc' },
            copper: { mode: 'marketCap', order: 'desc' },
            fertilizer: { mode: 'marketCap', order: 'desc' },
            platinum: { mode: 'marketCap', order: 'desc' },
            lithium: { mode: 'marketCap', order: 'desc' },
            uranium: { mode: 'marketCap', order: 'desc' },
            nickel: { mode: 'marketCap', order: 'desc' },
            ree: { mode: 'marketCap', order: 'desc' },
            titanium: { mode: 'marketCap', order: 'desc' }
        };
        
        function renderTilesInSection(containerId, sectionData, sectionName) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            // ã‚»ã‚¯ã‚·ãƒ§ãƒ³åã‹ã‚‰ä¸¦ã¹æ›¿ãˆçŠ¶æ…‹ã‚’å–å¾—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯æ™‚ä¾¡ç·é¡é †ï¼‰
            const sortState = sectionSortState[sectionName] || { mode: 'marketCap', order: 'desc' };
            
            sectionData.sort((a, b) => {
                if (sortState.mode === 'changePercent') {
                    // ä¸Šæ˜‡ç‡é †ã§ä¸¦ã¹æ›¿ãˆ
                    const aChange = a.changePercent !== null && a.changePercent !== undefined ? a.changePercent : -999;
                    const bChange = b.changePercent !== null && b.changePercent !== undefined ? b.changePercent : -999;
                    return sortState.order === 'desc' ? bChange - aChange : aChange - bChange;
                } else if (sortState.mode === 'rsi') {
                    // RSIé †ã§ä¸¦ã¹æ›¿ãˆ
                    const aRsi = a.rsi !== null && a.rsi !== undefined ? a.rsi : -1;
                    const bRsi = b.rsi !== null && b.rsi !== undefined ? b.rsi : -1;
                    return sortState.order === 'desc' ? bRsi - aRsi : aRsi - bRsi;
                } else {
                    // æ™‚ä¾¡ç·é¡é †ã§ä¸¦ã¹æ›¿ãˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
                    const isJapaneseA = ['2036', '1541', '1542', '1673', '1674'].includes(a.symbol);
                    const isJapaneseB = ['2036', '1541', '1542', '1673', '1674'].includes(b.symbol);
                    let aMarketCap = a.marketCap || marketCapEstimates[a.symbol] || 1000;
                    let bMarketCap = b.marketCap || marketCapEstimates[b.symbol] || 1000;
                    if (isJapaneseA && a.currency === 'JPY') {
                        aMarketCap = aMarketCap / 150; // ãƒ‰ãƒ«æ›ç®—
                    }
                    if (isJapaneseB && b.currency === 'JPY') {
                        bMarketCap = bMarketCap / 150; // ãƒ‰ãƒ«æ›ç®—
                    }
                    return sortState.order === 'desc' ? bMarketCap - aMarketCap : aMarketCap - bMarketCap;
                }
            });
            sectionData.forEach((stockData, index) => {
                const tile = createDynamicTile(stockData);
                setTimeout(() => {
                    container.appendChild(tile);
                    setTimeout(() => {
                        const canvas = tile.querySelector('.chart-canvas');
                        if (canvas && stockData.historicalPrices && stockData.historicalPrices.length > 1) {
                            const tileClasses = tile.className;
                            let chartOpacity = tileClasses.includes('neutral') ? 0.6 : 
                                              tileClasses.includes('loss-') ? 0.55 : 0.5;
                            let useWhiteChart = tileClasses.includes('gain-');
                            if (tileClasses.includes('size-mini') || tileClasses.includes('size-micro')) {
                                chartOpacity += 0.1;
                            }
                            canvas.style.opacity = chartOpacity.toString();
                            drawMiniChart(canvas, stockData.historicalPrices, stockData.changePercent, useWhiteChart);
                        } else if (canvas) {
                            drawPlaceholderChart(canvas, stockData.changePercent);
                        }
                    }, 50);
                }, index * 100);
            });
        }
        
        function updateAllTiles(stocksArray) {
            const sectionData = {
                gold: stocksArray.filter(s => metalSymbols.gold.includes(s.symbol)),
                silver: stocksArray.filter(s => metalSymbols.silver.includes(s.symbol)),
                copper: stocksArray.filter(s => metalSymbols.copper.includes(s.symbol)),
                fertilizer: stocksArray.filter(s => metalSymbols.fertilizer.includes(s.symbol)),
                platinum: stocksArray.filter(s => metalSymbols.platinum.includes(s.symbol)),
                lithium: stocksArray.filter(s => metalSymbols.lithium.includes(s.symbol)),
                uranium: stocksArray.filter(s => metalSymbols.uranium.includes(s.symbol)),
                nickel: stocksArray.filter(s => metalSymbols.nickel.includes(s.symbol)),
                ree: stocksArray.filter(s => metalSymbols.ree.includes(s.symbol)),
                titanium: stocksArray.filter(s => metalSymbols.titanium.includes(s.symbol))
            };
            
            renderTilesInSection('goldContainer', sectionData.gold, 'gold');
            setTimeout(() => renderTilesInSection('silverContainer', sectionData.silver, 'silver'), 200);
            setTimeout(() => renderTilesInSection('copperContainer', sectionData.copper, 'copper'), 400);
            setTimeout(() => renderTilesInSection('fertilizerContainer', sectionData.fertilizer, 'fertilizer'), 600);
            setTimeout(() => renderTilesInSection('platinumContainer', sectionData.platinum, 'platinum'), 800);
            setTimeout(() => renderTilesInSection('lithiumContainer', sectionData.lithium, 'lithium'), 1000);
            setTimeout(() => renderTilesInSection('uraniumContainer', sectionData.uranium, 'uranium'), 1200);
            setTimeout(() => renderTilesInSection('nickelContainer', sectionData.nickel, 'nickel'), 1400);
            setTimeout(() => renderTilesInSection('reeContainer', sectionData.ree, 'ree'), 1600);
            setTimeout(() => renderTilesInSection('titaniumContainer', sectionData.titanium, 'titanium'), 1800);
            setTimeout(() => { updateTileColors(); updateMarketCapStats(stocksArray); }, 2000);
        }
        
        function updateMarketCapStats(stocksArray) {
            const totalMarketCap = stocksArray.reduce((sum, s) => {
                const isJapanese = ['2036', '1541', '1542', '1673', '1674'].includes(s.symbol);
                let marketCap = s.marketCap || marketCapEstimates[s.symbol] || 1000;
                if (isJapanese && s.currency === 'JPY') {
                    marketCap = marketCap / 150; // ãƒ‰ãƒ«æ›ç®—
                }
                return sum + marketCap;
            }, 0);
            document.getElementById('marketCapStats').textContent = `$${(totalMarketCap / 1000).toFixed(0)}B`;
        }
        
        function updateTileColors() {
            document.querySelectorAll('.dynamic-tile').forEach(tile => {
                const changeElement = tile.querySelector('.change');
                if (!changeElement) return;
                const changeText = changeElement.textContent.trim();
                if (!changeText || changeText === 'å¾…æ©Ÿä¸­') { 
                    tile.classList.remove('gain-extreme', 'gain-high', 'gain-medium', 'gain-low', 'loss-low', 'loss-medium', 'loss-high', 'loss-extreme', 'neutral');
                    tile.classList.add('neutral'); 
                    return; 
                }
                const changeValue = parseFloat(changeText.replace('%', '').replace('+', ''));
                if (isNaN(changeValue)) { 
                    tile.classList.remove('gain-extreme', 'gain-high', 'gain-medium', 'gain-low', 'loss-low', 'loss-medium', 'loss-high', 'loss-extreme', 'neutral');
                    tile.classList.add('neutral'); 
                    return; 
                }
                
                const thresholds = {
                    'daily': { extreme: 20, high: 4, medium: 2 },
                    'week': { extreme: 30, high: 10, medium: 5 },
                    'month': { extreme: 50, high: 20, medium: 10 },
                    '3month': { extreme: 75, high: 30, medium: 15 },
                    'year': { extreme: 100, high: 50, medium: 25 }
                };
                const t = thresholds[currentPeriod] || thresholds['daily'];
                tile.classList.remove('gain-extreme', 'gain-high', 'gain-medium', 'gain-low', 'loss-low', 'loss-medium', 'loss-high', 'loss-extreme', 'neutral');
                
                if (changeValue > 0) {
                    if (changeValue >= t.extreme) tile.classList.add('gain-extreme');
                    else if (changeValue >= t.high) tile.classList.add('gain-high');
                    else if (changeValue >= t.medium) tile.classList.add('gain-medium');
                    else tile.classList.add('gain-low');
                } else if (changeValue < 0) {
                    const absValue = Math.abs(changeValue);
                    if (absValue >= t.extreme) tile.classList.add('loss-extreme');
                    else if (absValue >= t.high) tile.classList.add('loss-high');
                    else if (absValue >= t.medium) tile.classList.add('loss-medium');
                    else tile.classList.add('loss-low');
                } else tile.classList.add('neutral');
            });
        }
        
        function updateLegend() {
            const thresholds = {'realtime':{extreme:10,high:3,medium:1.5},'daily': {extreme:20,high:4,medium:2},'week':{extreme:30,high:10,medium:5},'month':{extreme:50,high:20,medium:10},'3month':{extreme:75,high:30,medium:15}};
            const t = thresholds[currentPeriod] || thresholds['daily'];
            document.getElementById('legend-gain-extreme').textContent = `+${t.extreme}%+`;
            document.getElementById('legend-gain-high').textContent = `+${t.high}%+`;
            document.getElementById('legend-gain-medium').textContent = `+${t.medium}~${t.high}%`;
            document.getElementById('legend-gain-low').textContent = `0~+${t.medium}%`;
            document.getElementById('legend-loss-low').textContent = `0~-${t.medium}%`;
            document.getElementById('legend-loss-medium').textContent = `-${t.medium}~-${t.high}%`;
            document.getElementById('legend-loss-high').textContent = `-${t.high}~-${t.extreme}%`;
            document.getElementById('legend-loss-extreme').textContent = `-${t.extreme}%-`;
        }
        
        async function changePeriod(period) {
            if (currentPeriod === period || isUpdating) return;
            currentPeriod = period;
            document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-period="${period}"]`).classList.add('active');
            document.getElementById('currentPeriod').textContent = {'daily':'æ—¥æ¬¡','week':'é€±æ¬¡','month':'æœˆæ¬¡','3month':'3ãƒ¶æœˆ','year':'1å¹´'}[period];
            updateLegend();
            
            // join JSONã‚’ç›´æ¥èª­ã¿è¾¼ã‚“ã§è¡¨ç¤º
            await loadJoinData(period);
        }
        
        // ğŸ“– join JSONã‚’ç›´æ¥èª­ã¿è¾¼ã‚“ã§è¡¨ç¤ºï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨: ã‚µãƒ¼ãƒãƒ¼APIã‚’ä½¿ç”¨ã—ãªã„ï¼‰
        async function loadJoinData(period) {
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆä¸¦ã¹æ›¿ãˆãƒœã‚¿ãƒ³ã§ä½¿ç”¨ï¼‰
            window.currentStocksData = null;
            try {
                console.log(`ğŸ“– join JSONèª­ã¿è¾¼ã¿é–‹å§‹: ${period}`);
                // ãƒ•ã‚¡ã‚¤ãƒ«åã®ãƒãƒƒãƒ”ãƒ³ã‚°
                const periodFileMap = {
                    'daily': 'joined_daily.json',
                    'week': 'joined_week.json',
                    'month': 'joined_month.json',
                    '3month': 'joined_3month.json',
                    'year': 'joined_year.json'
                };
                const DATA_PATH = './public/data';
                
                const fileName = periodFileMap[period];
                if (!fileName) {
                    throw new Error(`ä¸æ˜ãªæœŸé–“: ${period}`);
                }
                
                const filePath = `${DATA_PATH}/${fileName}`;
                console.log(`ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹: ${filePath}`);
                
                const response = await fetch(filePath, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error(`joinãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (${period})ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„: ${filePath}`);
                    }
                    throw new Error(`ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${response.status}`);
                }
                
                const joinData = await response.json();
                console.log(`âœ… join JSONèª­ã¿è¾¼ã¿æˆåŠŸ: ${period}`, joinData.meta);
                
                // joinãƒ‡ãƒ¼ã‚¿ã‚’stocksDataå½¢å¼ã«å¤‰æ›
                stocksData = Object.values(joinData.symbols).map(symbolData => ({
                    symbol: symbolData.symbol,
                    currentPrice: symbolData.price,
                    price: symbolData.price,
                    priceFormatted: symbolData.priceFormatted,
                    previousPrice: symbolData.previousPrice,
                    change: symbolData.change,
                    changePercent: symbolData.changePercent,
                    high: symbolData.high,
                    low: symbolData.low,
                    open: symbolData.open,
                    marketCap: symbolData.marketCap,
                    marketCapFormatted: symbolData.marketCapFormatted,
                    dataPoints: symbolData.dataPoints,
                    historicalPrices: symbolData.historicalPrices || [],
                    metalTag: symbolData.metalTag,
                    hasIbLabel: symbolData.hasIbLabel,
                    rsi: symbolData.rsi,
                    rsiPeriod: symbolData.rsiPeriod,
                    sentiment: symbolData.sentiment,
                    currency: symbolData.currency,
                    eodhdSymbol: symbolData.eodhdSymbol,
                    countryLabel: symbolData.countryLabel,
                    // wobbleæƒ…å ±ã‚’è¿½åŠ ï¼ˆæ®µå·®ãƒ¬ãƒ™ãƒ«ï¼‰
                    wobbleLevel: symbolData.wobbleLevel !== undefined ? symbolData.wobbleLevel : (symbolData.crackLevel !== undefined ? symbolData.crackLevel : 0),
                    crackScores: symbolData.crackScores || {},
                    crackTotalScore: symbolData.crackTotalScore || 0,
                    // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã€æ—§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚æ®‹ã™
                    crackLevel: symbolData.wobbleLevel !== undefined ? symbolData.wobbleLevel : (symbolData.crackLevel !== undefined ? symbolData.crackLevel : 0)
                }));
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆä¸¦ã¹æ›¿ãˆãƒœã‚¿ãƒ³ã§ä½¿ç”¨ï¼‰
                window.currentStocksData = stocksData;
                
                // ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°
                ['goldContainer', 'silverContainer', 'copperContainer', 'fertilizerContainer', 'platinumContainer', 'lithiumContainer', 'uraniumContainer', 'nickelContainer', 'reeContainer', 'titaniumContainer']
                    .forEach(id => document.getElementById(id).innerHTML = '');
                setTimeout(() => updateAllTiles(stocksData), 200);
                
                // æ›´æ–°æ™‚åˆ»ã‚’è¡¨ç¤º
                if (joinData.meta && joinData.meta.updated_at) {
                    const updatedDate = new Date(joinData.meta.updated_at);
                    document.getElementById('lastUpdate').textContent = 
                        updatedDate.getFullYear() + '-' + String(updatedDate.getMonth() + 1).padStart(2, '0') + '-' +
                        String(updatedDate.getDate()).padStart(2, '0') + ' ' +
                        String(updatedDate.getHours()).padStart(2, '0') + ':' + String(updatedDate.getMinutes()).padStart(2, '0');
                }
                
                showNotification(`âœ… ${period}ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº† (${stocksData.length}éŠ˜æŸ„)`, 'success');
            } catch (error) {
                console.error('âŒ join JSONèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                showNotification(`âš ï¸ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '-' +
                String(now.getDate()).padStart(2, '0') + ' ' +
                String(now.getHours()).padStart(2, '0') + ':' + String(now.getMinutes()).padStart(2, '0');
        }
        
        // ãã®ä»–ã®å›½åˆ¥éŠ˜æŸ„ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        function updateOtherCountriesList(stocksData) {
            const container = document.getElementById('otherCountriesList');
            if (!container) return;
            
            // ç±³å›½ãƒ»ã‚«ãƒŠãƒ€ãƒ»æ—¥æœ¬ä»¥å¤–ã®éŠ˜æŸ„ã‚’å›½åˆ¥ã«åˆ†é¡
            const countryGroups = {};
            const countryNames = {
                'AU': { name: 'ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢', flag: 'ğŸ‡¦ğŸ‡º' },
                'GB': { name: 'ã‚¤ã‚®ãƒªã‚¹', flag: 'ğŸ‡¬ğŸ‡§' },
                'CN': { name: 'ä¸­å›½', flag: 'ğŸ‡¨ğŸ‡³' },
                'DE': { name: 'ãƒ‰ã‚¤ãƒ„', flag: 'ğŸ‡©ğŸ‡ª' },
                'HK': { name: 'é¦™æ¸¯', flag: 'ğŸ‡­ğŸ‡°' }
            };
            
            stocksData.forEach(stock => {
                const country = stock.countryLabel || stock.exchange;
                if (country && country !== 'US' && country !== 'CA' && country !== 'JP') {
                    if (!countryGroups[country]) {
                        countryGroups[country] = [];
                    }
                    countryGroups[country].push(stock);
                }
            });
            
            // ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
            if (Object.keys(countryGroups).length === 0) {
                container.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.6); padding: 20px;">ç±³å›½ãƒ»ã‚«ãƒŠãƒ€ãƒ»æ—¥æœ¬ä»¥å¤–ã®éŠ˜æŸ„ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            let html = '';
            Object.keys(countryGroups).sort().forEach(country => {
                const stocks = countryGroups[country];
                const countryInfo = countryNames[country] || { name: country, flag: 'ğŸŒ' };
                
                html += `
                    <div class="country-group">
                        <div class="country-group-header">
                            <span class="country-flag">${countryInfo.flag}</span>
                            <span class="country-name">${countryInfo.name}</span>
                            <span class="country-count">${stocks.length}éŠ˜æŸ„</span>
                        </div>
                        <div class="country-symbols">
                            ${stocks.map(stock => {
                                const price = stock.currentPrice || stock.price || 'N/A';
                                const change = stock.changePercent !== null && stock.changePercent !== undefined ? 
                                    (stock.changePercent >= 0 ? '+' : '') + stock.changePercent.toFixed(2) + '%' : 'N/A';
                                const companyName = companyNames[stock.symbol] || stock.symbol;
                                return `
                                    <div class="country-symbol-item" title="${companyName}">
                                        <strong>${stock.symbol}</strong> - ${price} (${change})
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function showNotification(message, type = 'success') {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => { notification.classList.remove('show'); setTimeout(() => notification.remove(), 300); }, 3000);
        }
        
        // å¸‚å ´é–‹å ´æ™‚é–“ã®è¨ˆç®—ã¨è¡¨ç¤ºï¼ˆæ—¥æœ¬æ™‚é–“åŸºæº–ï¼‰
        function updateMarketHours() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            
            // å¤æ™‚é–“/å†¬æ™‚é–“ã®åˆ¤å®š
            const isDST = isDaylightSavingTime(now);
            const timeInfo = isDST ? 'å¤æ™‚é–“ (DST)' : 'å†¬æ™‚é–“ (æ¨™æº–æ™‚)';
            
            // å¸‚å ´é–‹å ´æ™‚é–“ã®è¨­å®šï¼ˆæ—¥æœ¬æ™‚é–“ JST = UTC+9ï¼‰
            const marketHours = {
                us: isDST ? { start: 22, end: 5 } : { start: 23, end: 6 }, // ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯ (å¤: 9:30-16:00 EST â†’ 22:30-5:00 JST, å†¬: 9:30-16:00 EST â†’ 23:30-6:00 JST)
                ca: isDST ? { start: 22, end: 5 } : { start: 23, end: 6 }, // ãƒˆãƒ­ãƒ³ãƒˆ (ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯ã¨åŒã˜)
                au: isDST ? { start: 7, end: 15 } : { start: 8, end: 16 },   // ã‚·ãƒ‰ãƒ‹ãƒ¼ (å¤: 10:00-16:00 AEDT â†’ 8:00-14:00 JST, å†¬: 10:00-16:00 AEST â†’ 9:00-15:00 JST)
                jp: { start: 9, end: 15 }  // æ±äº¬ (9:00-15:00 JST)
            };
            
            // æƒ…å ±è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('marketHoursInfo').textContent = 
                `ç¾åœ¨: ${year}å¹´${month}æœˆ${day}æ—¥ - ${timeInfo} | æ—¥æœ¬æ™‚é–“åŸºæº–`;
            
            // æ™‚é–“ã‚°ãƒªãƒƒãƒ‰ã‚’ç”Ÿæˆ
            const hoursGrid = document.getElementById('hoursGrid');
            hoursGrid.innerHTML = '';
            for (let i = 0; i < 24; i++) {
                const span = document.createElement('span');
                span.textContent = i.toString();
                hoursGrid.appendChild(span);
            }
            
            // å„å¸‚å ´ã®é–‹å ´æ™‚é–“ãƒãƒ¼ã‚’æ›´æ–°
            updateMarketBar('usHours', marketHours.us);
            updateMarketBar('caHours', marketHours.ca);
            updateMarketBar('auHours', marketHours.au);
            updateMarketBar('jpHours', marketHours.jp);
        }
        
        // å¤æ™‚é–“ã®åˆ¤å®š
        function isDaylightSavingTime(date) {
            const year = date.getFullYear();
            
            // ç±³å›½å¤æ™‚é–“: 3æœˆç¬¬2æ—¥æ›œæ—¥ 2:00 AM - 11æœˆç¬¬1æ—¥æ›œæ—¥ 2:00 AM
            const marchSecondSunday = getSecondSunday(year, 2); // 3æœˆ
            const novemberFirstSunday = getFirstSunday(year, 10); // 11æœˆ
            
            return date >= marchSecondSunday && date < novemberFirstSunday;
        }
        
        // ç¬¬Næ—¥æ›œæ—¥ã‚’å–å¾—
        function getFirstSunday(year, month) {
            const firstDay = new Date(year, month, 1);
            const dayOfWeek = firstDay.getDay();
            const daysToAdd = dayOfWeek === 0 ? 0 : 7 - dayOfWeek;
            return new Date(year, month, 1 + daysToAdd);
        }
        
        function getSecondSunday(year, month) {
            const firstSunday = getFirstSunday(year, month);
            return new Date(year, month, firstSunday.getDate() + 7);
        }
        
        // å¸‚å ´ãƒãƒ¼ã®æ›´æ–°
        function updateMarketBar(elementId, hours) {
            const element = document.getElementById(elementId);
            const startPercent = (hours.start / 24) * 100;
            const endPercent = (hours.end / 24) * 100;
            
            let gradient;
            if (hours.end > hours.start) {
                // é€šå¸¸ã®æ™‚é–“ç¯„å›²ï¼ˆåŒã˜æ—¥ï¼‰
                gradient = `linear-gradient(90deg, 
                    transparent 0%, 
                    transparent ${startPercent}%, 
                    #4CAF50 ${startPercent}%, 
                    #4CAF50 ${endPercent}%, 
                    transparent ${endPercent}%, 
                    transparent 100%)`;
            } else {
                // æ—¥ã‚’ã¾ãŸãæ™‚é–“ç¯„å›²ï¼ˆã‚·ãƒ‰ãƒ‹ãƒ¼ãªã©ï¼‰
                gradient = `linear-gradient(90deg, 
                    #4CAF50 0%, 
                    #4CAF50 ${endPercent}%, 
                    transparent ${endPercent}%, 
                    transparent ${startPercent}%, 
                    #4CAF50 ${startPercent}%, 
                    #4CAF50 100%)`;
            }
            
            element.style.background = gradient;
        }
        
        // éŠ˜æŸ„è©³ç´°è¡¨ç¤ºé–¢æ•°
        function showDetails(ticker) {
            const companyName = companyNames[ticker] || 'ä¼æ¥­åä¸æ˜';
            const stockData = stocksData.find(stock => stock.symbol === ticker);
            
            let detailsHtml = `
                <div style="background: rgba(0,0,0,0.9); padding: 20px; border-radius: 10px; color: white; max-width: 400px;">
                    <h3 style="margin: 0 0 15px 0; color: #4CAF50;">${ticker}</h3>
                    <p style="margin: 0 0 10px 0; font-size: 16px; font-weight: bold;">${companyName}</p>
            `;
            
            if (stockData) {
                detailsHtml += `
                    <div style="margin: 10px 0;">
                        <strong>ç¾åœ¨ä¾¡æ ¼:</strong> ${stockData.priceFormatted || 'N/A'}<br>
                        <strong>å¤‰å‹•ç‡:</strong> ${stockData.changePercent ? stockData.changePercent.toFixed(2) + '%' : 'N/A'}<br>
                        <strong>æ™‚ä¾¡ç·é¡:</strong> ${stockData.marketCapFormatted || 'N/A'}<br>
                        ${stockData.rsi !== null ? `<strong>RSI:</strong> ${stockData.rsi.toFixed(1)}<br>` : ''}
                        ${stockData.countryLabel ? `<strong>å¸‚å ´:</strong> ${stockData.countryLabel}<br>` : ''}
                        ${celebrityGrades[ticker] ? `<strong>è©•ä¾¡:</strong> ${celebrityGrades[ticker]}<br>` : ''}
                    </div>
                `;
            }
            
            detailsHtml += `
                    <button onclick="this.parentElement.remove()" style="background: #4CAF50; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-top: 10px;">é–‰ã˜ã‚‹</button>
                </div>
            `;
            
            // æ—¢å­˜ã®è©³ç´°è¡¨ç¤ºã‚’å‰Šé™¤
            const existingDetails = document.querySelector('.stock-details-overlay');
            if (existingDetails) {
                existingDetails.remove();
            }
            
            // æ–°ã—ã„è©³ç´°è¡¨ç¤ºã‚’ä½œæˆ
            const overlay = document.createElement('div');
            overlay.className = 'stock-details-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            overlay.innerHTML = detailsHtml;
            
            // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    overlay.remove();
                }
            };
            
            document.body.appendChild(overlay);
        }
        
        // ä¸¦ã¹æ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        function setupSortButtons() {
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    const sortType = this.getAttribute('data-sort-type'); // 'changePercent' ã¾ãŸã¯ 'rsi'
                    const sortState = sectionSortState[section];
                    
                    if (!sortState || !sortType) return;
                    
                    // åŒã˜ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯æ˜‡é †/é™é †ã‚’åˆ‡ã‚Šæ›¿ãˆ
                    // ç•°ãªã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆï¼ˆé™é †ã§é–‹å§‹ï¼‰
                    if (sortState.mode === sortType) {
                        // åŒã˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ˜‡é †/é™é †ã‚’åˆ‡ã‚Šæ›¿ãˆ
                        sortState.order = sortState.order === 'desc' ? 'asc' : 'desc';
                    } else {
                        // ç•°ãªã‚‹ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆï¼ˆé™é †ã§é–‹å§‹ï¼‰
                        sortState.mode = sortType;
                        sortState.order = 'desc';
                    }
                    
                    // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’æ›´æ–°
                    const sectionButtons = document.querySelectorAll(`.sort-btn[data-section="${section}"]`);
                    sectionButtons.forEach(button => {
                        const buttonSortType = button.getAttribute('data-sort-type');
                        const icon = button.querySelector('.sort-icon');
                        const text = button.querySelector('.sort-text');
                        
                        if (sortState.mode === buttonSortType) {
                            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒœã‚¿ãƒ³
                            button.classList.add('active');
                            if (buttonSortType === 'changePercent') {
                                icon.textContent = sortState.order === 'desc' ? 'ğŸ“ˆ' : 'ğŸ“‰';
                                text.textContent = sortState.order === 'desc' ? 'ï¼…ä¸Šæ˜‡ç‡é †â†“' : 'ï¼…ä¸Šæ˜‡ç‡é †â†‘';
                            } else if (buttonSortType === 'rsi') {
                                icon.textContent = sortState.order === 'desc' ? 'ğŸ“Š' : 'ğŸ“Š';
                                text.textContent = sortState.order === 'desc' ? 'RSIé †â†“' : 'RSIé †â†‘';
                            }
                        } else {
                            // éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒœã‚¿ãƒ³
                            button.classList.remove('active');
                            if (buttonSortType === 'changePercent') {
                                icon.textContent = 'ğŸ“ˆ';
                                text.textContent = 'ï¼…ä¸Šæ˜‡ç‡é †';
                            } else if (buttonSortType === 'rsi') {
                                icon.textContent = 'ğŸ“Š';
                                text.textContent = 'RSIé †';
                            }
                        }
                    });
                    
                    // è©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å†æç”»
                    const containerMap = {
                        'gold': 'goldContainer',
                        'silver': 'silverContainer',
                        'copper': 'copperContainer',
                        'fertilizer': 'fertilizerContainer',
                        'platinum': 'platinumContainer',
                        'lithium': 'lithiumContainer',
                        'uranium': 'uraniumContainer',
                        'nickel': 'nickelContainer',
                        'ree': 'reeContainer',
                        'titanium': 'titaniumContainer'
                    };
                    
                    const containerId = containerMap[section];
                    if (containerId && window.currentStocksData) {
                        const sectionData = window.currentStocksData.filter(s => {
                            const sectionSymbols = {
                                'gold': metalSymbols.gold,
                                'silver': metalSymbols.silver,
                                'copper': metalSymbols.copper,
                                'fertilizer': metalSymbols.fertilizer,
                                'platinum': metalSymbols.platinum,
                                'lithium': metalSymbols.lithium,
                                'uranium': metalSymbols.uranium,
                                'nickel': metalSymbols.nickel,
                                'ree': metalSymbols.ree,
                                'titanium': metalSymbols.titanium
                            };
                            return sectionSymbols[section] && sectionSymbols[section].includes(s.symbol);
                        });
                        renderTilesInSection(containerId, sectionData, section);
                    }
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            updateLegend();
            updateTimestamp();
            updateMarketHours();
            
            // ä¸¦ã¹æ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            setupSortButtons();
            
            // åˆæœŸè¡¨ç¤ºæ™‚ã«join JSONã‚’ç›´æ¥èª­ã¿è¾¼ã‚€ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ï¼‰
            try {
                await loadJoinData(currentPeriod);
            } catch (error) {
                console.log('âš ï¸ åˆæœŸèª­ã¿è¾¼ã¿å¤±æ•—ï¼ˆjoinãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å¯èƒ½æ€§ï¼‰:', error.message);
                showNotification(`âš ï¸ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
            
            showNotification('ğŸš€ Metals Treemap æº–å‚™å®Œäº†!', 'success');
        });
    </script>
</body>
</html>
